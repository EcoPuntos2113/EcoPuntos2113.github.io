<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <link rel="icon" type="image/svg+xml" href="/favicon.svg" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>EcoPuntos Dashboard</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css" integrity="sha512-DTOQO9RWCH3ppGqcWaEA1BIZOC6xxalwEsw9c2QQeAIftl+Vegovlnee1c9QX4TctnWMn13TZye+giMm8e2LwA==" crossorigin="anonymous" referrerpolicy="no-referrer" />
    <style>
      :root {
        --bg-color: #F7F8FA;
        --text-color: #1f2937;
        --text-subtle: #4b5563;
        --card-bg: #ffffff;
        --sidebar-bg: #2E3A4B;
        --sidebar-text: #e5e7eb;
        --sidebar-hover-bg: #3b4a5f;
        --border-color: #e5e7eb;
        --hover-bg: #f3f4f6;
        --primary-color: #2ECC71;
        --primary-dark: #27ae60;
        --secondary-color: #8b5cf6;
        --warning-color: #f59e0b;
        --success-color: #2ECC71;
        --dark-text: #ffffff;
      }
      .dark {
        --bg-color: #111827;
        --text-color: #e5e7eb;
        --text-subtle: #9ca3af;
        --card-bg: #1f2937;
        --sidebar-bg: #1f2937;
        --sidebar-text: #e5e7eb;
        --sidebar-hover-bg: #374151;
        --border-color: #374151;
        --hover-bg: #374151;
        --primary-color: #2ECC71;
        --primary-dark: #27ae60;
        --secondary-color: #A78BFA;
        --warning-color: #f59e0b;
        --success-color: #2ECC71;
        --dark-text: #ffffff;
      }
      /* Improved focus visibility for accessibility */
      :focus-visible {
          outline: 2px solid var(--primary-color);
          outline-offset: 2px;
          border-radius: 4px;
      }
      /* Toast notification animations */
      @keyframes toast-in { from { transform: translateY(-100%); opacity: 0; } to { transform: translateY(0); opacity: 1; } }
      @keyframes toast-out { from { transform: translateY(0); opacity: 1; } to { transform: translateY(-100%); opacity: 0; } }
      .toast-in { animation: toast-in 0.5s ease-out forwards; }
      .toast-out { animation: toast-out 0.5s ease-in forwards; }

      /* from GlobalStyles.tsx */
      body { -webkit-font-smoothing: antialiased; -moz-osx-font-smoothing: grayscale; }
      .prose { color: var(--text-color); }
      .prose h3 { color: var(--text-color); margin-bottom: 0.5em; }
      .prose p, .prose ul, .prose ol { color: var(--text-subtle); }
      .prose strong { color: var(--text-color); }
      .prose li::marker { color: var(--primary-color); }
      @keyframes fade-in { 0% { opacity: 0; } 100% { opacity: 1; } }
      .animate-fade-in { animation: fade-in 0.5s ease-out forwards; }
      @keyframes fade-in-down { 0% { opacity: 0; transform: translateY(-20px) scale(0.95); } 100% { opacity: 1; transform: translateY(0) scale(1); } }
      .animate-fade-in-down { animation: fade-in-down 0.4s ease-out forwards; }
      @keyframes stagger-in { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }
      .animate-stagger-in { animation: stagger-in 0.5s ease-out backwards; animation-fill-mode: backwards; }
      @keyframes shake { 0%, 100% { transform: translateX(0); } 25% { transform: translateX(-5px); } 75% { transform: translateX(5px); } }
      .animate-shake { animation: shake 0.5s ease-in-out; }
      @keyframes scan { 0% { transform: translateY(0); } 100% { transform: translateY(100%); } }
      .animate-scan { animation: scan 3s ease-in-out 1; }
    </style>
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
      tailwind.config = {
        darkMode: 'class',
        theme: {
          extend: {
            colors: {
              background: 'var(--bg-color)', text: 'var(--text-color)', 'text-subtle': 'var(--text-subtle)', card: 'var(--card-bg)', sidebar: 'var(--sidebar-bg)', 'sidebar-text': 'var(--sidebar-text)', 'sidebar-hover': 'var(--sidebar-hover-bg)', border: 'var(--border-color)', hover: 'var(--hover-bg)', primary: 'var(--primary-color)', 'primary-dark': 'var(--primary-dark)', secondary: 'var(--secondary-color)', warning: 'var(--warning-color)', success: 'var(--success-color)', 'dark-text': 'var(--dark-text)',
            },
            boxShadow: { 'primary-25': '0 0 25px -5px var(--primary-color)', 'primary-40': '0 0 40px -10px var(--primary-color)', 'primary-50': '0 0 50px -15px var(--primary-color)', }
          }
        }
      }
    </script>
    <script type="importmap">
    {
      "imports": {
        "react": "https://esm.sh/react@18.2.0",
        "react-dom/client": "https://esm.sh/react-dom@18.2.0/client"
      }
    }
    </script>
</head>
  <body class="bg-background text-text">
    <div id="root"></div>
    <script type="module">
// BUNDLED REACT APPLICATION - COMPILED TO RUN DIRECTLY IN BROWSER
import React, { useState, useEffect, useCallback, useContext, useRef, useMemo, createContext } from 'react';
import ReactDOM from 'react-dom/client';

// --- START: constants.ts ---
const mainNavItems = [
  { name: 'Inicio', icon: 'fa-solid fa-house' },
  { name: 'Escáner', icon: 'fa-solid fa-qrcode' },
  { name: 'Tienda', icon: 'fa-solid fa-store' },
  { name: 'Educación', icon: 'fa-solid fa-book-open' },
  { name: 'Minijuegos', icon: 'fa-solid fa-gamepad' },
  { name: 'Comunidad', icon: 'fa-solid fa-users' },
  { name: 'Ranking', icon: 'fa-solid fa-trophy' },
  { name: 'Perfil', icon: 'fa-solid fa-user' },
];

// --- START: context.ts ---
const AppContext = createContext(null);
const useAppContext = () => {
    const context = useContext(AppContext);
    if (!context) throw new Error('useAppContext must be used within a AppContext.Provider');
    return context;
};

// --- START: components/hooks/usePersistentState.ts ---
const usePersistentState = (key, defaultValue) => {
    const [state, setState] = useState(() => {
        try {
            const storedValue = window.localStorage.getItem(key);
            if (storedValue) {
                const parsed = JSON.parse(storedValue);
                if (typeof defaultValue === 'object' && defaultValue !== null && !Array.isArray(defaultValue)) return { ...defaultValue, ...parsed };
                return parsed;
            }
        } catch (error) { console.error(`Error reading localStorage key “${key}”:`, error); }
        return defaultValue;
    });
    useEffect(() => {
        try { window.localStorage.setItem(key, JSON.stringify(state)); } 
        catch (error) { console.error(`Error setting localStorage key “${key}”:`, error); }
    }, [key, state]);
    return [state, setState];
};

// --- START: data/mockData.ts ---
const MOCK_USER = { name: 'Matias Cajas', initials: 'MC', location: 'Lima, Perú', level: 'EcoAmigo' };
const newLessons = [ { id: 'l6', category: "Fundamentos del Reciclaje", title: 'El Ciclo de Vida del Plástico', description: 'Sigue el viaje de una botella de plástico desde que la usas hasta que se convierte en un nuevo producto.', isPro: false, icon: 'fa-solid fa-arrows-spin', status: 'start', content: React.createElement(React.Fragment, null, React.createElement('h3', null, 'Un Viaje de Transformación'), React.createElement('p', null, 'El plástico que reciclas no desaparece, ¡se transforma!'), React.createElement('ol', null, React.createElement('li', null, React.createElement('strong', null, 'Recolección:'), ' Todo empieza cuando depositas tu botella en el contenedor amarillo.'), React.createElement('li', null, React.createElement('strong', null, 'Clasificación:'), ' En la planta, se separan los diferentes tipos de plásticos (PET, HDPE, etc.).'), React.createElement('li', null, React.createElement('strong', null, 'Triturado y Lavado:'), ' El plástico se tritura en pequeños trozos llamados "escamas" y se lava para eliminar impurezas.'), React.createElement('li', null, React.createElement('strong', null, 'Creación de Pellets:'), ' Las escamas se derriten y se convierten en pequeños granos de plástico reciclado, o "pellets".'), React.createElement('li', null, React.createElement('strong', null, 'Nuevo Producto:'), ' ¡Estos pellets se usan para fabricar nuevas botellas, fibra textil para ropa, muebles y mucho más!'))) }, ];
const learningPaths = [ { id: 'lp1', title: 'Guardián del Plástico', description: 'Conviértete en un experto en el reciclaje de plásticos y reduce su impacto en el planeta.', icon: 'fa-solid fa-shield-halved', rewardPoints: 150, isCompleted: false, achievementId: 'ach-lp1', steps: [ { id: 'lps1', type: 'lesson', itemId: 'l1', title: 'Aprende lo Básico', description: 'Completa la lección "Reciclaje Básico 101".', status: 'available', points: 25 }, { id: 'lps2', type: 'game', itemId: 'g3', title: 'Ponlo a Prueba', description: 'Juega a "Clasifica la Basura" para practicar.', status: 'locked', points: 20 }, { id: 'lps3', type: 'mission', itemId: 'm5_new', title: 'Actúa', description: 'Completa la misión "Escanea un producto 3 veces".', status: 'locked', points: 25 }, { id: 'lps4', type: 'lesson', itemId: 'l6', title: 'Profundiza tu Conocimiento', description: 'Completa la lección "El Ciclo de Vida del Plástico".', status: 'locked', points: 30 }, ] }, { id: 'lp2', title: 'Maestro del Compostaje', description: 'Domina el arte de convertir tus residuos orgánicos en abono para dar vida a tus plantas.', icon: 'fa-solid fa-leaf', rewardPoints: 100, isCompleted: false, achievementId: 'ach-lp2', steps: [ { id: 'lps5', type: 'lesson', itemId: 'l7', title: 'Introducción al Compost', description: 'Completa la lección "Compostaje Casero".', status: 'available', points: 25 }, { id: 'lps6', type: 'mission', itemId: 'm8_new', title: '¡A compostar!', description: 'Registra tus primeros 5 restos orgánicos.', status: 'locked', points: 50 }, { id: 'lps7', type: 'game', itemId: 'g1', title: 'Demuestra lo que Sabes', description: 'Juega una partida de "Quiz Ecológico".', status: 'locked', points: 20 }, ] } ];
const INITIAL_APP_STATE = { stats: { points: 1870, impact: 95, recycling: 18, rank: 32 }, missions: [ { id: 'm2', icon: 'fa-solid fa-lightbulb', description: 'Completa la lección "Ahorro Energético"', points: 30 }, { id: 'm3', icon: 'fa-solid fa-share', description: 'Comparte un consejo en la comunidad', points: 20 }, { id: 'm5_new', icon: 'fa-solid fa-qrcode', description: 'Escanea un producto 3 veces', points: 25, progress: { current: 1, total: 3 }}, { id: 'm6_new', icon: 'fa-solid fa-gift', description: 'Canjea una recompensa en la tienda', points: 50 }, { id: 'm7_new', icon: 'fa-solid fa-graduation-cap', description: 'Completa 2 lecciones educativas', points: 40, progress: { current: 0, total: 2 }}, { id: 'm8_new', icon: 'fa-solid fa-seedling', description: 'Registra tus primeros 5 restos orgánicos', points: 50, progress: {current: 0, total: 5} }, ], history: [ { id: 'h1', icon: 'fa-solid fa-recycle', description: 'Botella de vidrio escaneada', timestamp: 'Hoy, 10:45 AM', points: 15 }, { id: 'h2', icon: 'fa-solid fa-bag-shopping', description: 'Bolsa reutilizable canjeada', timestamp: 'Ayer, 4:30 PM', points: -1500 }, { id: 'h3', icon: 'fa-solid fa-book-open', description: 'Lección "Reciclaje Básico 101" completada', timestamp: 'Ayer, 11:00 AM', points: 25 }, { id: 'h4', icon: 'fa-solid fa-gamepad', description: 'Recompensa del juego "Quiz Ecológico"', timestamp: 'Hace 2 días', points: 45 }, { id: 'h5', icon: 'fa-solid fa-beer-mug-empty', description: 'Lata de aluminio escaneada', timestamp: 'Hace 2 días', points: 12 }, { id: 'h6', icon: 'fa-solid fa-trophy', description: 'Bono por suscripción Pro', timestamp: 'Hace 3 días', points: 500 }, ], energy: 5, lastEnergyRecharge: Date.now(), games: [ { id: 'g1', title: 'Quiz Ecológico', description: 'Pon a prueba tus conocimientos sobre reciclaje y sostenibilidad.', isDailyChallenge: true, highScore: 0, points: 20, isPro: false, icon: 'fa-solid fa-circle-question' }, { id: 'g2', title: 'Memorama del Reciclaje', description: 'Encuentra las parejas de materiales y sus contenedores correspondientes.', highScore: 0, points: 25, isPro: false, icon: 'fa-solid fa-brain' }, { id: 'g3', title: 'Clasifica la Basura', description: 'Arrastra el residuo al contenedor correcto antes de que se acabe el tiempo.', highScore: 0, points: 20, isPro: false, icon: 'fa-solid fa-trash-can' }, { id: 'g4', title: 'Apaga la Luz', description: '¡Rápido! Apaga las luces encendidas para ahorrar energía y sumar puntos.', highScore: 0, points: 15, isPro: false, icon: 'fa-solid fa-power-off' }, { id: 'g5', title: 'Palabras Eco', description: 'Ordena las letras para encontrar la palabra ecológica oculta. ¡Solo para expertos!', highScore: 0, points: 30, isPro: true, icon: 'fa-solid fa-spell-check' } ], learningPaths };
const products = [ { id: 'p1', name: 'Botella de vidrio', category: 'Vidrio', points: 15, icon: 'fa-solid fa-wine-glass' }, { id: 'p3', name: 'Caja de cartón', category: 'Papel/Cartón', points: 8, icon: 'fa-solid fa-box-archive' }, { id: 'p4', name: 'Periódico', category: 'Papel', points: 5, icon: 'fa-solid fa-newspaper' }, { id: 'p5', name: 'Lata de aluminio', category: 'Metal', points: 12, icon: 'fa-solid fa-beer-mug-empty' }, { id: 'p6', name: 'Batería AA', category: 'Peligrosos', points: 20, icon: 'fa-solid fa-battery-full' }, { id: 'p7', name: 'Teléfono móvil', category: 'Electrónico', points: 18, icon: 'fa-solid fa-mobile-screen-button' }, { id: 'p8', name: 'Portátil', category: 'Electrónico', points: 30, icon: 'fa-solid fa-laptop' }, { id: 'p9', name: 'Frasco de mermelada', category: 'Vidrio', points: 12, icon: 'fa-solid fa-wine-glass' }, { id: 'p11', name: 'Revistas', category: 'Papel', points: 6, icon: 'fa-solid fa-book-open' }, { id: 'p12', name: 'Latas de conserva', category: 'Metal', points: 10, icon: 'fa-solid fa-box-open' }, { id: 'p13', name: 'Cargador de móvil', category: 'Electrónico', points: 15, icon: 'fa-solid fa-mobile-screen-button' }, { id: 'p14', name: 'Ropa de algodón', category: 'Textil', points: 18, icon: 'fa-solid fa-shirt' }, { id: 'p15', name: 'Aceite de cocina usado', category: 'Peligrosos', points: 25, icon: 'fa-solid fa-droplet' }, { id: 'p16', name: 'Caja de leche (Tetra Pak)', category: 'Mixto', points: 9, icon: 'fa-solid fa-box-archive' }, { id: 'p17', name: 'Bombilla de bajo consumo', category: 'Peligrosos', points: 22, icon: 'fa-solid fa-lightbulb' }, { id: 'p18', name: 'Libros viejos', category: 'Papel', points: 7, icon: 'fa-solid fa-book' }, { id: 'p19', name: 'Teclado de ordenador', category: 'Electrónico', points: 16, icon: 'fa-solid fa-keyboard' }, { id: 'p20', name: 'Neumático', category: 'Especial', points: 40, icon: 'fa-solid fa-car-burst' }, ];
const rewards = [ { id: 'r1', name: 'EcoBox Básica', description: 'Kit de inicio ecológico con bolsa reutilizable, botella de agua y cubiertos de bambú.', points: 1500, icon: 'fa-solid fa-box-archive' }, { id: 'r2', name: 'Bolsa Reutilizable', description: 'Bolsa de tela resistente para tus compras, disponible en varios diseños.', points: 2500, icon: 'fa-solid fa-bag-shopping' }, { id: 'r3', name: 'Botella de Acero', description: 'Botella térmica de acero inoxidable para mantener tus bebidas frías o calientes.', points: 3000, icon: 'fa-solid fa-wine-bottle' }, { id: 'r4', name: 'Planta un Árbol', description: 'Donación para plantar un árbol en tu nombre en una zona deforestada.', points: 3500, icon: 'fa-solid fa-tree' }, { id: 'r5', name: 'Descuento 20% Tienda Eco', description: 'Cupón de descuento para tiendas asociadas de productos sostenibles.', points: 2000, icon: 'fa-solid fa-percent' }, { id: 'r6', name: 'Kit de Café Sostenible', description: 'Taza reutilizable, café orgánico y filtro de tela para prepararlo.', points: 4000, icon: 'fa-solid fa-mug-hot' }, { id: 'r7', name: 'Cuponera de Ocio y Comida', description: 'Disfruta de descuentos exclusivos en cines y restaurantes de comida rápida.', points: 2800, icon: 'fa-solid fa-ticket' }, { id: 'r8', name: 'Kit de Limpieza Ecológico', description: 'Set de cepillos de bambú y paños de microfibra para una limpieza sin residuos.', points: 2200, icon: 'fa-solid fa-bucket' }, { id: 'r9', name: 'Semillas para Huerto Urbano', description: 'Empieza tu propio huerto en casa con este pack de semillas de hierbas aromáticas y hortalizas.', points: 1200, icon: 'fa-solid fa-seedling' }, ];
const lessons = [ { id: 'l1', category: "Fundamentos del Reciclaje", title: 'Reciclaje Básico 101', description: 'Aprende los fundamentos del reciclaje y cómo clasificar correctamente tus residuos.', isPro: false, icon: 'fa-solid fa-recycle', status: 'completed', content: React.createElement(React.Fragment, null, React.createElement('h3', null, 'Entendiendo los Contenedores'), React.createElement('p', null, 'Clasificar tus residuos es el primer paso para un reciclaje efectivo. Cada color de contenedor tiene un propósito específico:'), React.createElement('ul', null, React.createElement('li', null, React.createElement('strong', null, 'Azul (Papel y Cartón):'), ' Cajas, periódicos, revistas, folios. Asegúrate de que estén limpios y secos. Pliega las cajas para ahorrar espacio.'), React.createElement('li', null, React.createElement('strong', null, 'Amarillo (Plásticos y Envases):'), ' Botellas de plástico, latas de refresco, envases de yogurt, Tetra Paks, bolsas de plástico. Enjuaga los envases para evitar malos olores.'), React.createElement('li', null, React.createElement('strong', null, 'Verde (Vidrio):'), ' Botellas de vino, frascos de conservas, tarros de perfume. ¡No incluyas tapas, corchos, bombillas o espejos!'), React.createElement('li', null, React.createElement('strong', null, 'Marrón (Orgánico):'), ' Restos de comida (fruta, verdura, carne, pescado), posos de café, servilletas de papel usadas. Ideal para compostaje.'), React.createElement('li', null, React.createElement('strong', null, 'Gris (Resto):'), ' Materiales no reciclables como pañales, cerámica, colillas, polvo, etc.'))) }, { id: 'l2', category: "Fundamentos del Reciclaje", title: 'Residuos Electrónicos (E-Waste)', description: 'Descubre cómo manejar adecuadamente los dispositivos electrónicos que ya no uses.', isPro: false, icon: 'fa-solid fa-laptop', status: 'start', content: React.createElement(React.Fragment, null, React.createElement('h3', null, 'El Peligro de la Basura Electrónica'), React.createElement('p', null, 'Los aparatos electrónicos contienen metales pesados y sustancias tóxicas como plomo, mercurio y cadmio. Si se desechan incorrectamente en la basura común, pueden filtrarse y contaminar gravemente el suelo y las fuentes de agua.'), React.createElement('h4', null, '¿Qué hacer con tu E-Waste?'), React.createElement('ol', null, React.createElement('li', null, React.createElement('strong', null, 'Reparar:'), ' Antes de desechar, siempre considera si el dispositivo puede ser reparado.'), React.createElement('li', null, React.createElement('strong', null, 'Donar o Vender:'), ' Si aún funciona pero ya no lo necesitas, dónalo o véndelo.'), React.createElement('li', null, React.createElement('strong', null, 'Punto Limpio:'), ' Lleva tus aparatos rotos a un "Punto Limpio" o centro de acopio especializado.'))) }, { id: 'l7', category: "Fundamentos del Reciclaje", title: 'Compostaje Casero', description: 'Transforma tus residuos orgánicos en abono rico en nutrientes para tus plantas.', isPro: false, icon: 'fa-solid fa-leaf', status: 'start', content: React.createElement(React.Fragment, null, React.createElement('h3', null, '¡Crea Tu Propio Oro Negro!'), React.createElement('p', null, 'El compostaje es un proceso natural que convierte tus restos de cocina y jardín en un fertilizante.'), React.createElement('h4', null, '¿Qué puedes compostar?'), React.createElement('ul', null, React.createElement('li', null, React.createElement('strong', null, 'Verdes (Ricos en Nitrógeno):'), ' Restos de frutas y verduras, posos de café, cáscaras de huevo.'), React.createElement('li', null, React.createElement('strong', null, 'Marrones (Ricos en Carbono):'), ' Hojas secas, ramas pequeñas, serrín, cartón.'))) }, { id: 'l3', category: "Hogar Sostenible", title: 'Ahorro Energético en el Hogar', description: 'Técnicas y consejos para reducir tu consumo de energía.', isPro: true, icon: 'fa-solid fa-lightbulb', status: 'locked', content: React.createElement(React.Fragment, null, React.createElement('h3', null, 'Tu Hogar, una Central de Ahorro'), React.createElement('ul', null, React.createElement('li', null, React.createElement('strong', null, 'Iluminación LED:'), ' Consumen hasta un 85% menos de energía y duran mucho más.'), React.createElement('li', null, React.createElement('strong', null, 'Apaga el "Consumo Fantasma":'), ' Desenchufa aparatos en modo "standby".'), React.createElement('li', null, React.createElement('strong', null, 'Electrodomésticos Eficientes:'), " Busca la etiqueta de eficiencia energética clase 'A'."))) }, { id: 'l4', category: "Hogar Sostenible", title: 'Consumo de Agua Responsable', description: 'Cómo reducir tu huella hídrica y usar el agua de manera más eficiente.', isPro: false, icon: 'fa-solid fa-droplet', status: 'start', content: React.createElement(React.Fragment, null, React.createElement('h3', null, 'Cada Gota Cuenta'), React.createElement('ul', null, React.createElement('li', null, React.createElement('strong', null, 'Duchas cortas:'), ' Intenta reducir tu tiempo en la ducha a 5 minutos.'), React.createElement('li', null, React.createElement('strong', null, 'Cierra el grifo:'), ' No dejes el agua corriendo mientras te cepillas los dientes o lavas los platos.'), React.createElement('li', null, React.createElement('strong', null, 'Repara fugas:'), ' Un grifo que gotea puede desperdiciar miles de litros al año.'))) }, { id: 'l5', category: "Consumo Responsable", title: 'Movilidad Sostenible', description: 'Alternativas ecológicas para tus desplazamientos diarios.', isPro: true, icon: 'fa-solid fa-bicycle', status: 'locked', content: React.createElement(React.Fragment, null, React.createElement('h3', null, 'Muévete de Forma Inteligente'), React.createElement('p', null, 'El transporte es uno de los mayores emisores de gases de efecto invernadero. Elegir cómo nos movemos tiene un impacto directo.'), React.createElement('ul', null, React.createElement('li', null, React.createElement('strong', null, 'Caminar y Bici:'), ' Las opciones más saludables, económicas y ecológicas.'), React.createElement('li', null, React.createElement('strong', null, 'Transporte Público:'), ' Reduce drásticamente el número de coches en la carretera.'), React.createElement('li', null, React.createElement('strong', null, 'Coche Compartido:'), ' Organízate con compañeros para compartir un solo vehículo.'))) }, ...newLessons, ];
const initialPosts = [ { id: 'c1', author: { name: 'María José', initials: 'MJ' }, timestamp: 'Hace 2 horas', content: 'Hoy completé el reto de reciclaje semanal y logré reducir mi basura no reciclable en un 40%. ¡El truco fue lavar los envases antes de tirarlos al contenedor para evitar contaminación!', likes: 24, isLiked: false, comments: [ { id: 'c4', author: { name: 'Juan Pérez', initials: 'JP' }, timestamp: 'Hace 1 hora', content: '¡Gran consejo, María! Siempre se me olvida hacer eso, pero empezaré a aplicarlo.', likes: 5, isLiked: false, comments: [] }, { id: 'c5', author: { name: 'Ana García', initials: 'AG' }, timestamp: 'Hace 45 minutos', content: 'Totalmente de acuerdo. Además, ayuda a que no haya malos olores en el cubo de reciclaje.', likes: 11, isLiked: true, comments: [] } ] }, { id: 'c2', author: { name: 'Carlos Rodríguez', initials: 'CR' }, timestamp: 'Ayer', content: '¿Alguien sabe dónde puedo reciclar pilas en Lima? Tengo varias acumuladas y no quiero tirarlas a la basura normal. ¡Gracias por la ayuda!', likes: 12, isLiked: false, comments: [ { id: 'c3', author: { name: 'EcoPuntos Oficial', initials: 'EP', isOfficial: true }, timestamp: 'Ayer', content: 'Hola Carlos, puedes llevar tus pilas usadas a los puntos de reciclaje de la municipalidad de tu distrito. ¡Gracias por tu compromiso!', likes: 45, isLiked: false, comments: [] } ] }, { id: 'c7', author: { name: 'Sofía Luna', initials: 'SL' }, timestamp: 'Hace 3 días', content: '¡Estoy muy feliz! Acabo de canjear mis primeros 1500 puntos por una EcoBox. ¡Qué emoción recibirla!', likes: 58, isLiked: false, comments: [] } ];
const mockUsers = [ { user: { name: 'Javier Torres', initials: 'JT', location: 'Arequipa' }, points: 5820 }, { user: { name: 'Sofia Vargas', initials: 'SV', location: 'Cusco' }, points: 5650 }, { user: { name: 'Mateo Castillo', initials: 'MC', location: 'Lima' }, points: 5410 }, { user: { name: 'Valentina Rojas', initials: 'VR', location: 'Trujillo' }, points: 5380 }, { user: { name: 'Lucas Navarro', initials: 'LN', location: 'Lima' }, points: 5290 }, { user: { name: 'Isabella Mendoza', initials: 'IM', location: 'Chiclayo' }, points: 5100 }, { user: { name: 'Daniel Soto', initials: 'DS', location: 'Lima' }, points: 4950 }, { user: { name: 'Camila Flores', initials: 'CF', location: 'Arequipa' }, points: 4870 }, { user: { name: 'Alejandro Reyes', initials: 'AR', location: 'Lima' }, points: 4720 }, { user: { name: 'Lucia Paredes', initials: 'LP', location: 'Cusco' }, points: 4610 }, { user: { name: 'Miguel Angel', initials: 'MA', location: 'Lima' }, points: 4430 }, { user: { name: 'Valeria Quispe', initials: 'VQ', location: 'Lima' }, points: 3980 }, ];

// --- START: components/ToastProvider.tsx ---
const ToastContext = createContext({ showToast: () => {} });
const useToast = () => useContext(ToastContext);
const Toast = ({ message, onDismiss }) => {
    const [isExiting, setIsExiting] = useState(false);
    useEffect(() => {
        const timer = setTimeout(() => { setIsExiting(true); setTimeout(() => onDismiss(message.id), 500); }, 3000);
        return () => clearTimeout(timer);
    }, [message.id, onDismiss]);
    const typeClasses = { success: 'bg-primary', error: 'bg-red-500', info: 'bg-blue-500' };
    const iconClass = message.type === 'success' ? 'fa-solid fa-circle-check' : 'fa-solid fa-circle-info';
    return React.createElement('div', { className: `flex items-center p-4 mb-4 text-white rounded-lg shadow-lg ${typeClasses[message.type]} ${isExiting ? 'toast-out' : 'toast-in'}`, role: "alert" }, React.createElement('i', { className: `${iconClass} w-5 h-5 mr-3` }), React.createElement('div', { className: "text-sm font-medium" }, message.message));
};
const ToastProvider = ({ children }) => {
    const [toasts, setToasts] = useState([]);
    const showToast = useCallback((message, type = 'info') => { const id = Date.now(); setToasts(prev => [...prev, { id, message, type }]); }, []);
    const dismissToast = (id) => { setToasts(prev => prev.filter(toast => toast.id !== id)); };
    return React.createElement(ToastContext.Provider, { value: { showToast } }, children, React.createElement('div', { className: "fixed top-5 left-1/2 -translate-x-1/2 z-[100] w-full max-w-xs" }, toasts.map(toast => React.createElement(Toast, { key: toast.id, message: toast, onDismiss: dismissToast }))));
};

// --- START: components/common ---
const ProgressBar = ({ current, total, className = '' }) => { const percentage = Math.min((current / total) * 100, 100); return React.createElement('div', { className: `w-full bg-hover rounded-full h-1.5 ${className}` }, React.createElement('div', { className: "bg-primary h-1.5 rounded-full transition-all duration-300 ease-in-out", style: { width: `${percentage}%` } })); };
const StatCard = ({ title, value, subtitle, badge, valueColor = 'text-primary', icon }) => { return React.createElement('div', { className: "bg-card p-6 rounded-xl shadow-sm flex flex-col items-center justify-center text-center h-48 transition-all duration-300 hover:shadow-xl dark:hover:shadow-primary-40 hover:-translate-y-2" }, icon && React.createElement('i', { className: `${icon} text-3xl mb-2 text-text-subtle`, "aria-hidden": "true" }), React.createElement('p', { className: "text-text-subtle font-medium" }, title), React.createElement('p', { className: `text-5xl font-bold my-2 ${valueColor}` }, value), React.createElement('p', { className: "text-text-subtle text-sm" }, subtitle), badge && React.createElement('span', { className: "mt-2 bg-secondary/20 text-secondary text-xs font-semibold px-3 py-1 rounded-full" }, badge)); };
const HistoryLogItem = React.memo(({ item, index }) => { return React.createElement('div', { className: "flex items-center py-4 border-b border-border last:border-b-0 animate-stagger-in", style: { animationDelay: `${index * 50}ms` } }, React.createElement('div', { className: "bg-hover p-2 rounded-full w-9 h-9 flex items-center justify-center" }, React.createElement('i', { className: `${item.icon} h-5 w-5 text-text-subtle`, "aria-hidden": "true" })), React.createElement('div', { className: "ml-4 flex-grow" }, React.createElement('p', { className: "text-text font-medium" }, item.description), React.createElement('p', { className: "text-xs text-text-subtle" }, item.timestamp)), React.createElement('div', { className: "ml-4" }, React.createElement('span', { className: `text-sm font-semibold ${item.points > 0 ? 'text-primary' : 'text-red-500'}` }, item.points > 0 ? `+${item.points}` : item.points, ' pts'))); });
const MissionItem = React.memo(({ mission, index }) => { return React.createElement('button', { className: "w-full text-left flex items-center py-2 px-3 my-1 border-b border-border last:border-b-0 hover:bg-hover rounded-lg transition-colors animate-stagger-in", style: { animationDelay: `${index * 100}ms` } }, React.createElement('div', { className: "bg-primary/10 p-2 rounded-full w-9 h-9 flex items-center justify-center" }, React.createElement('i', { className: `${mission.icon} h-5 w-5 text-primary`, "aria-hidden": "true" })), React.createElement('div', { className: "ml-4 flex-grow" }, React.createElement('p', { className: "text-text font-medium" }, mission.description), mission.progress && React.createElement(ProgressBar, { current: mission.progress.current, total: mission.progress.total, className: "mt-2" })), React.createElement('div', { className: "ml-4" }, React.createElement('span', { className: "bg-primary/20 text-primary-dark dark:text-primary text-sm font-semibold px-3 py-1.5 rounded-full whitespace-nowrap" }, `+${mission.points} pts`))); });
const AchievementCard = React.memo(({ ach, index }) => { return React.createElement('div', { className: `border rounded-lg p-4 flex flex-col items-center text-center transition-all duration-300 hover:-translate-y-1 hover:shadow-lg animate-stagger-in ${ach.isUnlocked ? 'border-primary bg-primary/10' : 'border-border bg-hover'}`, style: { animationDelay: `${index * 50}ms` } }, React.createElement('div', { className: `w-16 h-16 rounded-full flex items-center justify-center mb-3 ${ach.isUnlocked ? 'bg-primary' : 'bg-border'}` }, React.createElement('i', { className: `${ach.icon} text-3xl ${ach.isUnlocked ? 'text-dark-text' : 'text-text-subtle'}` })), React.createElement('h4', { className: "font-bold text-text" }, ach.name), React.createElement('p', { className: "text-xs text-text-subtle flex-grow my-2" }, ach.description), ach.progress && !ach.isUnlocked && React.createElement(ProgressBar, { current: ach.progress.current, total: ach.progress.total, className: "my-2" }), React.createElement('p', { className: "text-xs font-semibold mt-2" }, ach.isUnlocked ? ach.unlockDate : (ach.progress ? `${Math.round(ach.progress.current / ach.progress.total * 100)}% completado` : 'Por desbloquear'))); });
const GameCard = React.memo(({ game, onGameClick, isProUser, index }) => { const isLocked = game.isPro && !isProUser; return React.createElement('div', { className: "bg-card rounded-xl shadow-sm overflow-hidden flex flex-col transition-all duration-300 hover:-translate-y-2 hover:shadow-xl animate-stagger-in", style: { animationDelay: `${index * 100}ms` } }, React.createElement('div', { className: `flex items-center justify-center h-40 relative ${isLocked ? 'bg-hover' : 'bg-primary'}` }, React.createElement('i', { className: `${game.icon} text-6xl ${isLocked ? 'text-text-subtle' : 'text-dark-text'}`, "aria-hidden": "true" }), game.isPro && React.createElement('div', { className: "absolute top-4 right-4 bg-warning text-dark-text text-xs font-bold px-2 py-1 rounded-full z-10" }, "PRO"), game.isDailyChallenge && React.createElement('div', { className: "absolute top-4 left-4 bg-yellow-400 text-dark-text text-xs font-bold px-2 py-1 rounded-full z-10 flex items-center gap-1" }, React.createElement('i', { className: "fa-solid fa-star w-4 h-4" }), " Desafío")), React.createElement('div', { className: "p-6 flex flex-col flex-grow" }, React.createElement('h3', { className: "text-lg font-bold text-text" }, game.title), React.createElement('p', { className: "text-sm text-text-subtle mt-1 mb-4 flex-grow" }, game.description), React.createElement('div', { className: "flex items-center text-sm text-text-subtle mb-4" }, React.createElement('i', { className: "fa-solid fa-award w-4 h-4 text-secondary mr-1" }), React.createElement('span', null, `Mejor Puntuación: ${game.highScore}`), React.createElement('span', { className: "ml-auto font-bold text-primary" }, `+${game.isDailyChallenge ? game.points*2 : game.points} pts`)), React.createElement('button', { onClick: onGameClick, className: `w-full py-3 rounded-lg font-semibold text-dark-text transition ${isLocked ? 'bg-warning hover:opacity-90' : 'bg-primary hover:bg-primary-dark'}` }, isLocked ? 'Adquirir Modo Pro' : 'Jugar'))); });
const PostCard = ({ post, onLike, onCommentSubmit, isReply = false, index }) => { const [isReplying, setIsReplying] = useState(false); const [commentContent, setCommentContent] = useState(''); const handleSubmit = (e) => { e.preventDefault(); if (commentContent.trim()) { onCommentSubmit(post.id, commentContent); setCommentContent(''); setIsReplying(false); } }; return React.createElement('div', { className: `bg-card rounded-xl shadow-sm p-4 sm:p-6 animate-stagger-in ${isReply ? 'ml-0 sm:ml-6' : ''}`, style: { animationDelay: `${index * 100}ms` } }, React.createElement('div', { className: "flex items-start mb-4" }, React.createElement('div', { className: `w-11 h-11 rounded-full flex items-center justify-center text-white font-bold flex-shrink-0 ${post.author.isOfficial ? 'bg-primary' : 'bg-secondary'}` }, post.author.initials), React.createElement('div', { className: "ml-4" }, React.createElement('p', { className: "font-bold text-text" }, post.author.name), React.createElement('p', { className: "text-sm text-text-subtle" }, post.timestamp))), React.createElement('p', { className: "text-text mb-4 whitespace-pre-wrap" }, post.content), React.createElement('div', { className: "flex items-center gap-6 text-sm text-text-subtle font-medium" }, React.createElement('button', { onClick: () => onLike(post.id), className: `flex items-center gap-2 hover:text-primary transition ${post.isLiked ? 'text-primary' : ''}`, "aria-label": `Me gusta a la publicación de ${post.author.name}` }, React.createElement('i', { className: `${post.isLiked ? 'fa-solid' : 'fa-regular'} fa-thumbs-up w-5 h-5` }), ` Me gusta (${post.likes})`), React.createElement('button', { onClick: () => setIsReplying(!isReplying), className: "flex items-center gap-2 hover:text-primary transition", "aria-label": `Comentar en la publicación de ${post.author.name}` }, React.createElement('i', { className: "fa-regular fa-comment w-5 h-5" }), " Comentar")), isReplying && React.createElement('form', { onSubmit: handleSubmit, className: "mt-4 flex gap-2 animate-fade-in" }, React.createElement('input', { type: "text", value: commentContent, onChange: (e) => setCommentContent(e.target.value), placeholder: "Escribe un comentario...", className: "w-full bg-hover border-none rounded-lg py-2 px-3 focus:ring-2 focus:ring-primary text-sm", autoFocus: true }), React.createElement('button', { type: "submit", className: "px-4 py-2 rounded-lg bg-primary text-dark-text text-sm font-semibold hover:bg-primary-dark transition" }, "Publicar")), post.comments && post.comments.length > 0 && React.createElement('div', { className: "mt-4 pt-4 space-y-4 border-t border-border" }, post.comments.map((comment, i) => React.createElement(PostCard, { key: comment.id, post: comment, onLike: onLike, onCommentSubmit: onCommentSubmit, isReply: true, index: i })))); };
const RankRow = React.memo(({ entry, index }) => { const rankColor = entry.rank === 1 ? 'text-yellow-400' : entry.rank === 2 ? 'text-gray-400' : entry.rank === 3 ? 'text-yellow-600' : 'text-text-subtle'; return React.createElement('div', { className: `flex items-center p-2 sm:p-4 rounded-lg animate-stagger-in transition-colors ${entry.isCurrentUser ? 'bg-primary/10 border-l-2 sm:border-l-4 border-primary' : ''}`, style: { animationDelay: `${index * 50}ms` } }, React.createElement('div', { className: "w-8 sm:w-12 text-center text-base sm:text-lg font-bold text-text-subtle" }, entry.rank), React.createElement('div', { className: `w-8 sm:w-12 text-center text-lg font-bold ${rankColor}` }, entry.rank <= 3 && React.createElement('i', { className: "fa-solid fa-trophy w-5 h-5 sm:w-6 sm:h-6 inline-block" })), React.createElement('div', { className: "flex items-center flex-grow" }, React.createElement('div', { className: `w-8 h-8 sm:w-10 sm:h-10 rounded-full flex items-center justify-center text-white font-bold flex-shrink-0 text-sm sm:text-base ${entry.isCurrentUser ? 'bg-primary' : 'bg-secondary'}` }, entry.user.initials), React.createElement('div', { className: "ml-2 sm:ml-4 overflow-hidden" }, React.createElement('p', { className: `font-bold text-sm sm:text-base truncate ${entry.isCurrentUser ? 'text-primary-dark dark:text-primary' : 'text-text'}` }, entry.user.name), React.createElement('p', { className: "text-xs sm:text-sm text-text-subtle" }, entry.user.location))), React.createElement('div', { className: "w-20 sm:w-32 text-right font-bold text-base sm:text-lg text-primary" }, entry.points.toLocaleString())); });
const RewardCard = React.memo(({ reward, onRedeem, index }) => { return React.createElement('div', { className: "bg-card rounded-xl shadow-sm overflow-hidden flex flex-col transition-all duration-300 hover:-translate-y-2 hover:shadow-xl animate-stagger-in", style: { animationDelay: `${index * 100}ms` } }, React.createElement('div', { className: "bg-primary flex items-center justify-center h-40" }, React.createElement('i', { className: `${reward.icon} text-6xl text-dark-text`, "aria-hidden": "true" })), React.createElement('div', { className: "p-6 flex flex-col flex-grow" }, React.createElement('h3', { className: "text-lg font-bold text-text" }, reward.name), React.createElement('p', { className: "text-sm text-text-subtle mt-1 mb-4 flex-grow" }, reward.description), React.createElement('div', { className: "flex items-center justify-between" }, React.createElement('span', { className: "font-bold text-primary" }, reward.points.toLocaleString(), " pts"), React.createElement('button', { onClick: () => onRedeem(reward), className: "bg-secondary text-dark-text px-5 py-2 rounded-lg font-semibold hover:opacity-90 transition" }, "Canjear")))); });

// --- START: components/modals ---
const ProModal = ({ onClose, onConfirm }) => React.createElement('div', { className: "fixed inset-0 bg-black bg-opacity-60 flex justify-center items-center z-50 p-4 animate-fade-in" }, React.createElement('div', { className: "bg-card rounded-2xl shadow-xl w-full max-w-md p-8 text-center relative animate-fade-in-down" }, React.createElement('button', { onClick: onClose, className: "absolute top-4 right-4 text-text-subtle hover:text-text" }, React.createElement('i', { className: "fa-solid fa-xmark w-6 h-6" })), React.createElement('div', { className: "mx-auto bg-primary/10 w-16 h-16 rounded-full flex items-center justify-center mb-4" }, React.createElement('i', { className: "fa-solid fa-crown w-8 h-8 text-primary text-3xl" })), React.createElement('h2', { className: "text-2xl font-bold text-text mb-2" }, "Modo Pro EcoPuntos"), React.createElement('p', { className: "text-text-subtle mb-6" }, "Desbloquea todo el potencial de EcoPuntos con el Modo Pro por solo 5 soles al mes. Accede a contenido exclusivo y acelera tu progreso en el cuidado del medio ambiente."), React.createElement('ul', { className: "text-left space-y-3 mb-8" }, [ { icon: 'fa-solid fa-lightbulb', text: 'Acceso a todas las lecciones educativas premium' }, { icon: 'fa-solid fa-gamepad', text: 'Minijuegos exclusivos con recompensas especiales' }, { icon: 'fa-solid fa-leaf', text: 'Estadísticas avanzadas de tu impacto ambiental' }, { icon: 'fa-solid fa-circle-check', text: 'Multiplicador de puntos x1.5 en todas tus actividades' } ].map((item, index) => React.createElement('li', { key: index, className: "flex items-center gap-3" }, React.createElement('i', { className: `${item.icon} w-5 h-5 text-primary flex-shrink-0` }), React.createElement('span', { className: "text-text" }, item.text)))), React.createElement('div', { className: "flex gap-4" }, React.createElement('button', { onClick: onClose, className: "w-full py-3 px-4 rounded-lg bg-hover text-text font-semibold hover:bg-border transition" }, "Cancelar"), React.createElement('button', { onClick: onConfirm, className: "w-full py-3 px-4 rounded-lg bg-primary text-dark-text font-semibold hover:bg-primary-dark transition shadow-lg hover:shadow-primary-50" }, "Adquirir por 5 soles/mes"))));
const LessonModal = ({ lesson, onClose }) => React.createElement('div', { className: "fixed inset-0 bg-black bg-opacity-60 flex justify-center items-center z-50 p-4 animate-fade-in", onClick: onClose }, React.createElement('div', { className: "bg-card rounded-2xl shadow-xl w-full max-w-2xl max-h-[90vh] flex flex-col", onClick: e => e.stopPropagation() }, React.createElement('div', { className: "p-6 border-b border-border flex justify-between items-center" }, React.createElement('h2', { className: "text-2xl font-bold text-text" }, lesson.title), React.createElement('button', { onClick: onClose, className: "text-text-subtle hover:text-text" }, React.createElement('i', { className: "fa-solid fa-xmark w-6 h-6" }))), React.createElement('div', { className: "p-8 overflow-y-auto" }, React.createElement('div', { className: "prose dark:prose-invert max-w-none text-text" }, lesson.content)), React.createElement('div', { className: "p-6 border-t border-border text-right" }, React.createElement('button', { onClick: onClose, className: "py-2 px-6 rounded-lg bg-primary text-dark-text font-semibold hover:bg-primary-dark transition" }, "Cerrar"))));
const SettingsModal = ({ onClose }) => { const { user, onUserUpdate, showToast } = useAppContext(); const [activeTab, setActiveTab] = useState('perfil'); const [formData, setFormData] = useState({ name: '', location: '' }); useEffect(() => { if (user) setFormData({ name: user.name || '', location: user.location || '' }); }, [user]); const handleInputChange = (e) => { const { name, value } = e.target; setFormData(prev => ({ ...prev, [name]: value })); }; const handleSave = () => { if (user) onUserUpdate({ ...user, ...formData, initials: formData.name.split(' ').map(n => n[0]).join('') }); showToast('Cambios guardados exitosamente.', 'success'); onClose(); }; const renderTabContent = () => { switch (activeTab) { case 'perfil': return React.createElement('div', { className: "space-y-4 animate-fade-in" }, React.createElement('div', null, React.createElement('label', { className: "text-sm font-medium text-text-subtle" }, "Nombre Completo"), React.createElement('input', { type: "text", name: "name", value: formData.name, onChange: handleInputChange, className: "w-full mt-1 px-4 py-2 border border-border rounded-lg focus:outline-none focus:ring-2 focus:ring-primary bg-hover text-text" })), React.createElement('div', null, React.createElement('label', { className: "text-sm font-medium text-text-subtle" }, "Ubicación"), React.createElement('input', { type: "text", name: "location", value: formData.location, onChange: handleInputChange, className: "w-full mt-1 px-4 py-2 border border-border rounded-lg focus:outline-none focus:ring-2 focus:ring-primary bg-hover text-text" }))); case 'notificaciones': return React.createElement('div', { className: "space-y-4 animate-fade-in" }, React.createElement('div', { className: "flex items-center justify-between p-3 bg-hover rounded-lg" }, React.createElement('div', null, React.createElement('p', { className: "font-medium text-text" }, "Notificaciones por correo"), React.createElement('p', { className: "text-sm text-text-subtle" }, "Resumen semanal y alertas importantes.")), React.createElement('label', { className: "relative inline-flex items-center cursor-pointer" }, React.createElement('input', { type: "checkbox", value: "", className: "sr-only peer", defaultChecked: true }), React.createElement('div', { className: "w-11 h-6 bg-border peer-focus:outline-none rounded-full peer dark:bg-gray-700 peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all dark:border-gray-600 peer-checked:bg-primary" }))), React.createElement('div', { className: "flex items-center justify-between p-3 bg-hover rounded-lg" }, React.createElement('p', { className: "font-medium text-text" }, "Actividad de la comunidad"), React.createElement('label', { className: "relative inline-flex items-center cursor-pointer" }, React.createElement('input', { type: "checkbox", value: "", className: "sr-only peer" }), React.createElement('div', { className: "w-11 h-6 bg-border peer-focus:outline-none rounded-full peer dark:bg-gray-700 peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all dark:border-gray-600 peer-checked:bg-primary" })))); case 'seguridad': return React.createElement('div', { className: "space-y-4 animate-fade-in" }, React.createElement('button', { className: "w-full py-2 px-4 rounded-lg bg-hover text-text font-semibold hover:bg-border transition" }, "Cambiar Contraseña"), React.createElement('button', { className: "w-full py-2 px-4 rounded-lg text-red-500 bg-red-500/10 font-semibold hover:bg-red-500/20 transition" }, "Eliminar Cuenta")); default: return null; } }; return React.createElement('div', { className: "fixed inset-0 bg-black bg-opacity-60 flex justify-center items-center z-50 p-4 animate-fade-in", onClick: onClose }, React.createElement('div', { className: "bg-card rounded-2xl shadow-xl w-full max-w-lg flex flex-col", onClick: e => e.stopPropagation() }, React.createElement('div', { className: "p-6 border-b border-border flex justify-between items-center" }, React.createElement('h2', { className: "text-2xl font-bold text-text" }, "Configuración"), React.createElement('button', { onClick: onClose, className: "text-text-subtle hover:text-text" }, React.createElement('i', { className: "fa-solid fa-xmark w-6 h-6" }))), React.createElement('div', { className: "flex p-2 bg-hover border-b border-border" }, React.createElement('button', { onClick: () => setActiveTab('perfil'), className: `flex-1 py-2 px-4 text-center rounded-lg font-semibold transition ${activeTab === 'perfil' ? 'bg-card shadow-sm text-primary' : 'text-text-subtle'}` }, "Perfil"), React.createElement('button', { onClick: () => setActiveTab('notificaciones'), className: `flex-1 py-2 px-4 text-center rounded-lg font-semibold transition ${activeTab === 'notificaciones' ? 'bg-card shadow-sm text-primary' : 'text-text-subtle'}` }, "Notificaciones"), React.createElement('button', { onClick: () => setActiveTab('seguridad'), className: `flex-1 py-2 px-4 text-center rounded-lg font-semibold transition ${activeTab === 'seguridad' ? 'bg-card shadow-sm text-primary' : 'text-text-subtle'}` }, "Seguridad")), React.createElement('div', { className: "p-6 overflow-y-auto" }, renderTabContent()), React.createElement('div', { className: "p-4 bg-hover border-t border-border flex justify-end gap-4" }, React.createElement('button', { onClick: onClose, className: "py-2 px-6 rounded-lg text-text font-semibold hover:bg-border transition" }, "Cancelar"), React.createElement('button', { onClick: handleSave, className: "py-2 px-6 rounded-lg bg-primary text-dark-text font-semibold hover:bg-primary-dark transition" }, "Guardar Cambios")))); };

// --- START: components/games ---
const GameContainer = ({ title, children, onExit }) => React.createElement('div', { className: "fixed inset-0 bg-background z-40 p-4 sm:p-8 flex flex-col animate-fade-in" }, React.createElement('header', { className: "flex items-center justify-between mb-4" }, React.createElement('h2', { className: "text-2xl font-bold text-primary" }, title), React.createElement('button', { onClick: onExit, className: "flex items-center gap-2 px-4 py-2 rounded-lg bg-hover text-text font-semibold hover:bg-border transition" }, React.createElement('i', { className: "fa-solid fa-xmark w-5 h-5" }), " Salir")), React.createElement('div', { className: "flex-grow bg-card rounded-xl shadow-inner flex items-center justify-center p-4" }, children));
const EcoQuizGame = ({ onGameEnd }) => { const QUESTIONS = [ { question: "¿Qué color de contenedor se usa para el vidrio?", options: ["Amarillo", "Azul", "Verde", "Gris"], answer: "Verde" }, { question: "¿Cuál de estos no es un gas de efecto invernadero?", options: ["Dióxido de Carbono", "Metano", "Oxígeno", "Óxido Nitroso"], answer: "Oxígeno" }, { question: "La 'economía circular' se opone a la economía...", options: ["Capitalista", "Lineal", "Socialista", "Global"], answer: "Lineal" }, { question: "¿Qué significa 'compostar'?", options: ["Quemar basura", "Enterrar residuos", "Descomponer materia orgánica", "Separar plásticos"], answer: "Descomponer materia orgánica" }, { question: "¿Cuál de estos es un plástico de un solo uso?", options: ["Botella reutilizable", "Taza de cerámica", "Pajita/Popote de plástico", "Bolsa de tela"], answer: "Pajita/Popote de plástico" } ]; const questions = useRef(QUESTIONS.sort(() => 0.5 - Math.random())).current; const [currentQ, setCurrentQ] = useState(0); const [score, setScore] = useState(0); const [feedback, setFeedback] = useState(null); const handleAnswer = (option) => { if (feedback) return; const isCorrect = option === questions[currentQ].answer; if (isCorrect) { setScore(prev => prev + 10); setFeedback('correct'); } else { setFeedback('incorrect'); } setTimeout(() => { setFeedback(null); if (currentQ < questions.length - 1) { setCurrentQ(prev => prev + 1); } else { onGameEnd(score + (isCorrect ? 10 : 0)); } }, 1000); }; const q = questions[currentQ]; return React.createElement('div', { className: "w-full max-w-xl text-center" }, React.createElement('p', { className: "font-semibold text-text-subtle mb-2" }, `Pregunta ${currentQ + 1} de ${questions.length}`), React.createElement('h3', { className: "text-2xl font-bold text-text mb-8" }, q.question), React.createElement('div', { className: "grid grid-cols-1 sm:grid-cols-2 gap-4" }, q.options.map(opt => { const getButtonClass = () => { if (!feedback) return 'bg-hover hover:bg-border'; if (opt === q.answer) return 'bg-primary text-dark-text animate-pulse'; if (feedback === 'incorrect' && opt !== q.answer) return 'bg-red-500/50 text-dark-text'; return 'bg-hover opacity-50'; }; return React.createElement('button', { key: opt, onClick: () => handleAnswer(opt), className: `p-4 rounded-lg font-semibold transition-all duration-300 ${getButtonClass()}`, disabled: !!feedback }, opt) })), React.createElement('p', { className: "text-xl font-bold mt-8 text-primary" }, `Puntuación: ${score}`)); };
const MemoryGame = ({ onGameEnd }) => { const MEMORY_ITEMS = [ { type: 'glass', icon: 'fa-solid fa-wine-glass' }, { type: 'paper', icon: 'fa-solid fa-newspaper' }, { type: 'plastic', icon: 'fa-solid fa-bottle-water' }, { type: 'organic', icon: 'fa-solid fa-carrot' }, { type: 'metal', icon: 'fa-solid fa-beer-mug-empty' }, { type: 'ewaste', icon: 'fa-solid fa-mobile-screen-button' }, ]; const generateCards = () => [...MEMORY_ITEMS, ...MEMORY_ITEMS].map((item, i) => ({ ...item, id: i })).sort(() => Math.random() - 0.5); const [cards, setCards] = useState(generateCards); const [flipped, setFlipped] = useState([]); const [matched, setMatched] = useState([]); const [score, setScore] = useState(0); const flipTimeout = useRef(null); useEffect(() => { if (matched.length === MEMORY_ITEMS.length) setTimeout(() => onGameEnd(score), 500); }, [matched, onGameEnd, score]); useEffect(() => { if (flipped.length === 2) { const [firstId, secondId] = flipped; const firstCard = cards.find(c => c.id === firstId); const secondCard = cards.find(c => c.id === secondId); if (firstCard && secondCard && firstCard.type === secondCard.type) { setMatched(prev => [...prev, firstCard.type]); setScore(prev => prev + 20); setFlipped([]); } else { flipTimeout.current = window.setTimeout(() => setFlipped([]), 1000); } } }, [flipped, cards]); useEffect(() => { return () => { if (flipTimeout.current) clearTimeout(flipTimeout.current); }; }, []); const handleFlip = (id) => { if (flipped.length < 2 && !flipped.includes(id) && !matched.includes(cards.find(c => c.id === id)?.type || '')) { if (flipTimeout.current) clearTimeout(flipTimeout.current); setFlipped(prev => [...prev, id]); } }; return React.createElement('div', { className: "w-full max-w-2xl text-center" }, React.createElement('p', { className: "text-xl font-bold mb-6 text-primary" }, `Puntuación: ${score}`), React.createElement('div', { className: "grid grid-cols-4 gap-4" }, cards.map(card => { const isFlipped = flipped.includes(card.id) || matched.includes(card.type); return React.createElement('div', { key: card.id, className: "w-full aspect-square [perspective:1000px]", onClick: () => handleFlip(card.id) }, React.createElement('div', { className: `relative w-full h-full transition-transform duration-500 [transform-style:preserve-3d] ${isFlipped ? '[transform:rotateY(180deg)]' : ''}` }, React.createElement('div', { className: "absolute inset-0 bg-primary rounded-lg flex items-center justify-center [backface-visibility:hidden]" }, React.createElement('i', { className: "fa-solid fa-leaf text-5xl text-dark-text" })), React.createElement('div', { className: "absolute inset-0 bg-card rounded-lg flex items-center justify-center [backface-visibility:hidden] [transform:rotateY(180deg)]" }, React.createElement('i', { className: `${card.icon} text-5xl text-primary` })))); }))); };
const SortTheTrashGame = ({ onGameEnd }) => { const ITEMS = [ { name: "Botella de Plástico", category: "Plástico" }, { name: "Periódico", category: "Papel" }, { name: "Frasco de Vidrio", category: "Vidrio" }, { name: "Cáscara de Plátano", category: "Orgánico" }, { name: "Lata de Aluminio", category: "Metal" }, { name: "Caja de Cartón", category: "Papel" }, ]; const BINS = [ { name: "Orgánico", icon: "fa-solid fa-leaf", color: "bg-green-500" }, { name: "Vidrio", icon: "fa-solid fa-wine-glass", color: "bg-blue-500" }, { name: "Papel", icon: "fa-solid fa-newspaper", color: "bg-cyan-500" }, { name: "Plástico", icon: "fa-solid fa-bottle-water", color: "bg-yellow-500" }, { name: "Metal", icon: "fa-solid fa-gear", color: "bg-gray-500" }, ]; const items = useRef(ITEMS.sort(() => 0.5 - Math.random())).current; const [currentItemIndex, setCurrentItemIndex] = useState(0); const [score, setScore] = useState(0); const [timeLeft, setTimeLeft] = useState(5); const [feedback, setFeedback] = useState(null); const timerIdRef = useRef(null); useEffect(() => { if (timerIdRef.current) clearTimeout(timerIdRef.current); if (feedback || currentItemIndex >= items.length) return; setTimeLeft(5); const tick = () => { setTimeLeft(prev => { const newTime = prev - 1; if (newTime <= 0) { setFeedback('timeup'); return 0; } else { timerIdRef.current = window.setTimeout(tick, 1000); return newTime; } }); }; timerIdRef.current = window.setTimeout(tick, 1000); return () => { if (timerIdRef.current) clearTimeout(timerIdRef.current); }; }, [currentItemIndex, feedback]); const handleAnswer = (binCategory) => { if (feedback) return; if (timerIdRef.current) { clearTimeout(timerIdRef.current); timerIdRef.current = null; } const isCorrect = items[currentItemIndex].category === binCategory; if (isCorrect) { setScore(s => s + 10); setFeedback('correct'); } else { setScore(s => s - 5); setFeedback('incorrect'); } }; const handleNextItem = () => { if (currentItemIndex < items.length - 1) { setCurrentItemIndex(i => i + 1); setFeedback(null); } else { onGameEnd(score); } }; const item = items[currentItemIndex]; if (!item) return null; const feedbackMessage = { correct: '¡Correcto!', incorrect: '¡Incorrecto!', timeup: '¡Tiempo Agotado!' }; const feedbackTextColor = feedback === 'correct' ? 'text-primary' : 'text-red-500'; return React.createElement('div', { className: "w-full max-w-2xl text-center" }, React.createElement('div', { className: "flex justify-between items-center mb-6" }, React.createElement('p', { className: "text-xl font-bold text-primary" }, `Puntuación: ${score}`), React.createElement('p', { className: "text-xl font-bold text-warning" }, `Tiempo: ${timeLeft}s`)), React.createElement('div', { className: `bg-hover p-8 rounded-xl mb-8 transition-colors duration-300 relative ${feedback === 'correct' ? 'bg-primary/20' : ''} ${feedback === 'incorrect' || feedback === 'timeup' ? 'bg-red-500/20' : ''}` }, React.createElement('h3', { className: "text-3xl font-bold text-text" }, item.name)), feedback && React.createElement('div', { className: "animate-fade-in text-center mb-8" }, React.createElement('p', { className: `text-2xl font-bold mb-6 ${feedbackTextColor}` }, feedbackMessage[feedback]), React.createElement('button', { onClick: handleNextItem, className: "px-8 py-3 rounded-lg bg-primary text-dark-text text-lg font-semibold hover:bg-primary-dark transition" }, currentItemIndex < items.length - 1 ? 'Siguiente Objeto' : 'Finalizar Juego')), !feedback && React.createElement('div', { className: "grid grid-cols-2 lg:grid-cols-5 gap-4 animate-fade-in" }, BINS.map(bin => React.createElement('button', { key: bin.name, onClick: () => handleAnswer(bin.name), className: `p-4 rounded-lg text-white font-semibold flex flex-col items-center justify-center aspect-square transition-transform hover:scale-105 ${bin.color}`, disabled: !!feedback }, React.createElement('i', { className: `${bin.icon} text-4xl mb-2` }), React.createElement('span', null, bin.name))))); };
const LightsOutGame = ({ onGameEnd }) => { const GRID_SIZE = 9; const [lights, setLights] = useState(Array(GRID_SIZE).fill(false)); const [score, setScore] = useState(0); const [timeLeft, setTimeLeft] = useState(30); useEffect(() => { if (timeLeft <= 0) { onGameEnd(score); return; } const gameTimer = setTimeout(() => setTimeLeft(t => t - 1), 1000); return () => clearTimeout(gameTimer); }, [timeLeft, onGameEnd, score]); useEffect(() => { const lightUpTimer = setInterval(() => { setLights(prevLights => { const newLights = [...prevLights]; const offIndices = newLights.map((l, i) => !l ? i : -1).filter(i => i !== -1); if (offIndices.length > 0) { const randomIndex = offIndices[Math.floor(Math.random() * offIndices.length)]; newLights[randomIndex] = true; } return newLights; }); }, 800); return () => clearInterval(lightUpTimer); }, []); const handleClick = (index) => { if (lights[index] && timeLeft > 0) { setLights(prev => { const newLights = [...prev]; newLights[index] = false; return newLights; }); setScore(s => s + 5); } }; return React.createElement('div', { className: "w-full max-w-md text-center" }, React.createElement('div', { className: "flex justify-between items-center mb-6" }, React.createElement('p', { className: "text-xl font-bold text-primary" }, `Puntuación: ${score}`), React.createElement('p', { className: "text-xl font-bold text-warning" }, `Tiempo: ${timeLeft}s`)), React.createElement('div', { className: "grid grid-cols-3 gap-4" }, lights.map((isOn, i) => React.createElement('button', { key: i, onClick: () => handleClick(i), className: `aspect-square rounded-lg transition-all duration-150 ${isOn ? 'bg-yellow-400 shadow-lg shadow-yellow-400/50' : 'bg-hover'}`, "aria-label": `Light ${i+1}` })))); };
const EcoAnagramsGame = ({ onGameEnd }) => { const WORDS = [ { scrambled: 'ajelcicre', answer: 'reciclaje' }, { scrambled: 'tomascopj', answer: 'compostaj' }, { scrambled: 'trensgia', answer: 'energia' }, { scrambled: 'netobisle', answer: 'sostenible' }, { scrambled: 'coniamotcina', answer: 'contaminacion' }, ]; const words = useRef(WORDS.sort(() => 0.5 - Math.random())).current; const [currentWordIndex, setCurrentWordIndex] = useState(0); const [inputValue, setInputValue] = useState(''); const [score, setScore] = useState(0); const [feedback, setFeedback] = useState(null); const handleSubmit = (e) => { e.preventDefault(); if(feedback) return; const correct = inputValue.toLowerCase() === words[currentWordIndex].answer; setFeedback(correct ? 'correct' : 'incorrect'); setTimeout(() => { setFeedback(null); setInputValue(''); if (correct) { const newScore = score + 15; setScore(newScore); if (currentWordIndex === words.length - 1) onGameEnd(newScore); else setCurrentWordIndex(i => i + 1); } else { if (currentWordIndex === words.length - 1) onGameEnd(score); else setCurrentWordIndex(i => i + 1); } }, 1200); }; return React.createElement('div', { className: "w-full max-w-md text-center" }, React.createElement('p', { className: "font-semibold text-text-subtle mb-2" }, `Palabra ${currentWordIndex + 1} de ${words.length}`), React.createElement('div', { className: "bg-hover p-8 rounded-xl mb-8" }, React.createElement('h3', { className: "text-4xl font-bold text-text tracking-widest" }, words[currentWordIndex].scrambled.toUpperCase())), React.createElement('form', { onSubmit: handleSubmit, className: "flex gap-2" }, React.createElement('input', { type: "text", value: inputValue, onChange: e => setInputValue(e.target.value), className: `w-full text-center text-lg px-4 py-3 border-2 rounded-lg focus:outline-none focus:ring-2 bg-hover text-text transition-all ${ feedback === 'correct' ? 'border-primary focus:ring-primary' : '' } ${ feedback === 'incorrect' ? 'border-red-500 focus:ring-red-500 animate-shake' : '' } ${ !feedback ? 'border-border focus:ring-primary' : '' }`, placeholder: "Escribe la palabra", disabled: !!feedback, autoFocus: true }), React.createElement('button', { type: "submit", disabled: !inputValue || !!feedback, className: "py-3 px-6 rounded-lg bg-primary text-dark-text font-semibold hover:bg-primary-dark transition disabled:opacity-50" }, "Enviar")), React.createElement('p', { className: "text-xl font-bold mt-8 text-primary" }, `Puntuación: ${score}`)); };

// --- START: components/pages ---
const HomePage = () => { const { appState } = useAppContext(); return React.createElement(React.Fragment, null, React.createElement('div', { className: "grid grid-cols-1 md:grid-cols-2 xl:grid-cols-4 gap-6 mb-8" }, React.createElement(StatCard, { title: "Puntos Acumulados", value: appState.stats.points, subtitle: "", badge: "EcoAmigo", icon: 'fa-solid fa-coins' }), React.createElement(StatCard, { title: "Impacto Ambiental", value: appState.stats.impact, subtitle: "kg CO2 reducido", icon: 'fa-solid fa-leaf' }), React.createElement(StatCard, { title: "Reciclaje Esta Semana", value: appState.stats.recycling, subtitle: "productos", icon: 'fa-solid fa-recycle' }), React.createElement(StatCard, { title: "Posición en Ranking", value: `#${appState.stats.rank}`, subtitle: "a nivel nacional", icon: 'fa-solid fa-star' })), React.createElement('div', { className: "grid grid-cols-1 lg:grid-cols-2 gap-8" }, React.createElement('div', { className: "bg-card p-6 rounded-xl shadow-sm" }, React.createElement('div', { className: "flex items-center gap-3 mb-4" }, React.createElement('i', { className: "fa-solid fa-flag h-6 w-6 text-text-subtle" }), React.createElement('h2', { className: "text-xl font-bold text-text" }, "Misiones Semanales")), React.createElement('div', null, appState.missions.length > 0 ? appState.missions.map((m, i) => React.createElement(MissionItem, { key: m.id, mission: m, index: i })) : React.createElement('p', { className: "text-center py-4 text-text-subtle" }, "¡Felicidades! Has completado todas las misiones."))), React.createElement('div', { className: "bg-card p-6 rounded-xl shadow-sm" }, React.createElement('div', { className: "flex items-center gap-3 mb-4" }, React.createElement('i', { className: "fa-solid fa-ticket h-6 w-6 text-text-subtle" }), React.createElement('h2', { className: "text-xl font-bold text-text" }, "Sorteos Exclusivos")), appState.stats.points < 10000 ? (React.createElement('div', { className: "text-center bg-hover p-6 rounded-lg border border-border" }, React.createElement('i', { className: "fa-solid fa-lock w-8 h-8 text-warning mb-3 mx-auto" }), React.createElement('h3', { className: "font-bold text-text" }, "Desbloquea los Sorteos"), React.createElement('p', { className: "text-text-subtle text-sm mb-4" }, "¡Alcanza los 10,000 puntos para participar en sorteos de premios increíbles!"), React.createElement(ProgressBar, { current: appState.stats.points, total: 10000 }), React.createElement('p', { className: "text-xs text-text-subtle mt-2 font-semibold" }, `${appState.stats.points.toLocaleString()} / 10,000 pts`))) : (React.createElement('div', { className: "text-center animate-fade-in" }, React.createElement('i', { className: "fa-solid fa-gift w-12 h-12 text-primary mb-4 mx-auto" }), React.createElement('h3', { className: "text-lg font-bold" }, "¡Felicidades!"), React.createElement('p', { className: "text-text-subtle mb-4" }, "Has desbloqueado el acceso a los sorteos. ¡Buena suerte!"), React.createElement('button', { className: "bg-primary text-dark-text font-semibold px-6 py-2 rounded-lg hover:bg-primary-dark transition" }, "Ver Sorteos Disponibles")))), React.createElement('div', { className: "lg:col-span-2 bg-card p-6 rounded-xl shadow-sm" }, React.createElement('div', { className: "flex items-center gap-3 mb-4" }, React.createElement('i', { className: "fa-solid fa-clock-rotate-left h-6 w-6 text-text-subtle" }), React.createElement('h2', { className: "text-xl font-bold text-text" }, "Historial Reciente")), React.createElement('div', null, appState.history.slice(0, 5).map((item, i) => React.createElement(HistoryLogItem, { key: item.id, item: item, index: i })))))); };
const LoginPage = ({ onLogin }) => { const [view, setView] = useState('login'); const handleFormSubmit = (e) => { e.preventDefault(); onLogin(); }; const renderLoginView = () => React.createElement('div', { className: "animate-fade-in" }, React.createElement('h2', { className: "text-2xl font-bold text-center text-primary mb-6" }, "Iniciar Sesión"), React.createElement('form', { className: "space-y-4", onSubmit: handleFormSubmit }, React.createElement('div', {className:"relative"}, React.createElement('i', { className: "fa-solid fa-envelope absolute left-4 top-1/2 -translate-y-1/2 text-text-subtle" }), React.createElement('input', { className: "w-full pl-12 pr-4 py-3 border border-border rounded-lg focus:outline-none focus:ring-2 focus:ring-primary bg-hover text-text", type: "email", placeholder: "Correo Electrónico", required: true })), React.createElement('div', {className:"relative"}, React.createElement('i', { className: "fa-solid fa-lock absolute left-4 top-1/2 -translate-y-1/2 text-text-subtle" }), React.createElement('input', { className: "w-full pl-12 pr-4 py-3 border border-border rounded-lg focus:outline-none focus:ring-2 focus:ring-primary bg-hover text-text", type: "password", placeholder: "Contraseña", required: true })), React.createElement('button', { type: "submit", className: "w-full py-3 text-dark-text bg-primary rounded-lg font-semibold hover:bg-primary-dark transition-colors" }, "Entrar")), React.createElement('div', { className: "flex items-center justify-between text-sm mt-4" }, React.createElement('button', { onClick: () => setView('forgot'), className: "font-medium text-primary hover:underline" }, "¿Olvidaste tu contraseña?"), React.createElement('button', { onClick: () => setView('register'), className: "font-medium text-primary hover:underline" }, "Crear cuenta")), React.createElement('div', { className: "relative my-6" }, React.createElement('div', { className: "absolute inset-0 flex items-center" }, React.createElement('div', { className: "w-full border-t border-border" })), React.createElement('div', { className: "relative flex justify-center text-sm" }, React.createElement('span', { className: "px-2 bg-card text-text-subtle" }, "O inicia sesión con"))), React.createElement('div', { className: "flex justify-center space-x-4" }, React.createElement('button', { "aria-label": "Login with Google", onClick: onLogin, className: "w-12 h-12 flex items-center justify-center border border-border rounded-full hover:bg-hover transition" }, React.createElement('i', { className: "fa-brands fa-google text-xl" })), React.createElement('button', { "aria-label": "Login with Facebook", onClick: onLogin, className: "w-12 h-12 flex items-center justify-center border border-border rounded-full hover:bg-hover transition" }, React.createElement('i', { className: "fa-brands fa-facebook text-xl" })), React.createElement('button', { "aria-label": "Login with Apple", onClick: onLogin, className: "w-12 h-12 flex items-center justify-center border border-border rounded-full hover:bg-hover transition" }, React.createElement('i', { className: "fa-brands fa-apple text-xl" })))); const renderRegisterView = () => React.createElement('div', { className: "animate-fade-in" }, React.createElement('h2', { className: "text-2xl font-bold text-center text-primary mb-6" }, "Crear Cuenta"), React.createElement('form', { className: "space-y-4", onSubmit: handleFormSubmit }, React.createElement('div', { className: "relative" }, React.createElement('i', { className: "fa-solid fa-user absolute left-4 top-1/2 -translate-y-1/2 text-text-subtle" }), React.createElement('input', { className: "w-full pl-12 pr-4 py-3 border border-border rounded-lg focus:outline-none focus:ring-2 focus:ring-primary bg-hover text-text", type: "text", placeholder: "Nombre Completo", required: true })), React.createElement('div', { className: "relative" }, React.createElement('i', { className: "fa-solid fa-envelope absolute left-4 top-1/2 -translate-y-1/2 text-text-subtle" }), React.createElement('input', { className: "w-full pl-12 pr-4 py-3 border border-border rounded-lg focus:outline-none focus:ring-2 focus:ring-primary bg-hover text-text", type: "email", placeholder: "Correo Electrónico", required: true })), React.createElement('div', { className: "relative" }, React.createElement('i', { className: "fa-solid fa-lock absolute left-4 top-1/2 -translate-y-1/2 text-text-subtle" }), React.createElement('input', { className: "w-full pl-12 pr-4 py-3 border border-border rounded-lg focus:outline-none focus:ring-2 focus:ring-primary bg-hover text-text", type: "password", placeholder: "Contraseña", required: true })), React.createElement('button', { type: "submit", className: "w-full py-3 text-dark-text bg-primary rounded-lg font-semibold hover:bg-primary-dark transition-colors" }, "Registrarse")), React.createElement('div', { className: "text-center text-sm mt-4" }, React.createElement('span', { className: "text-text-subtle" }, "¿Ya tienes cuenta? "), React.createElement('button', { onClick: () => setView('login'), className: "font-medium text-primary hover:underline" }, "Inicia Sesión"))); const renderForgotView = () => React.createElement('div', { className: "animate-fade-in" }, React.createElement('h2', { className: "text-2xl font-bold text-center text-primary mb-6" }, "Recuperar Contraseña"), React.createElement('p', { className: "text-center text-text-subtle mb-6 text-sm" }, "Ingresa tu correo electrónico y te enviaremos un enlace para restablecer tu contraseña."), React.createElement('form', { className: "space-y-4", onSubmit: handleFormSubmit }, React.createElement('div', { className: "relative" }, React.createElement('i', { className: "fa-solid fa-envelope absolute left-4 top-1/2 -translate-y-1/2 text-text-subtle" }), React.createElement('input', { className: "w-full pl-12 pr-4 py-3 border border-border rounded-lg focus:outline-none focus:ring-2 focus:ring-primary bg-hover text-text", type: "email", placeholder: "Correo Electrónico", required: true })), React.createElement('button', { type: "submit", className: "w-full py-3 text-dark-text bg-primary rounded-lg font-semibold hover:bg-primary-dark transition-colors" }, "Enviar Enlace")), React.createElement('div', { className: "text-center text-sm mt-4" }, React.createElement('button', { onClick: () => setView('login'), className: "font-medium text-primary hover:underline" }, "Volver a Iniciar Sesión"))); return React.createElement('div', { className: "flex items-center justify-center min-h-screen bg-background p-4" }, React.createElement('div', { className: "w-full max-w-sm" }, React.createElement('div', { className: "text-center mb-8" }, React.createElement('i', { className: "fa-solid fa-leaf text-6xl text-primary mb-4", "aria-hidden": "true" }), React.createElement('h1', { className: "text-3xl font-bold text-text" }, "Bienvenido a EcoPuntos"), React.createElement('p', { className: "text-text-subtle mt-2" }, "Tu comunidad para un mundo más verde.")), React.createElement('div', { className: "bg-card rounded-2xl shadow-lg p-8 min-h-[490px] flex flex-col justify-center" }, view === 'login' && renderLoginView(), view === 'register' && renderRegisterView(), view === 'forgot' && renderForgotView()))); };
const CommunityPage = () => { const { user } = useAppContext(); const [posts, setPosts] = useState(initialPosts); const [newPostContent, setNewPostContent] = useState(''); const updatePostRecursively = (items, id, updateFn) => { return items.map(post => { if (post.id === id) return updateFn(post); if (post.comments.length > 0) return { ...post, comments: updatePostRecursively(post.comments, id, updateFn) }; return post; }); }; const handleLike = useCallback((id) => { setPosts(currentPosts => updatePostRecursively(currentPosts, id, post => ({ ...post, isLiked: !post.isLiked, likes: post.isLiked ? post.likes - 1 : post.likes + 1, }))); }, []); const addCommentRecursively = (items, parentId, newComment) => { return items.map(post => { if (post.id === parentId) return { ...post, comments: [newComment, ...post.comments] }; if (post.comments.length > 0) return { ...post, comments: addCommentRecursively(post.comments, parentId, newComment) }; return post; }); }; const handleCommentSubmit = useCallback((parentId, content) => { const newComment = { id: `c${Date.now()}`, author: { name: user.name, initials: user.initials }, timestamp: 'Ahora', content, likes: 0, isLiked: false, comments: [], }; setPosts(currentPosts => addCommentRecursively(currentPosts, parentId, newComment)); }, [user]); const handlePost = () => { if (!newPostContent.trim()) return; const newPost = { id: `c${Date.now()}`, author: { name: user.name, initials: user.initials }, timestamp: 'Ahora', content: newPostContent, likes: 0, isLiked: false, comments: [], }; setPosts([newPost, ...posts]); setNewPostContent(''); }; return React.createElement(React.Fragment, null, React.createElement('h2', { className: "text-2xl font-bold text-text mb-2" }, "Comunidad EcoPuntos"), React.createElement('p', { className: "text-text-subtle mb-8" }, "Comparte tus logros, consejos y preguntas con otros usuarios comprometidos con el medio ambiente."), React.createElement('div', { className: "bg-card rounded-xl shadow-sm p-6 mb-8" }, React.createElement('textarea', { value: newPostContent, onChange: e => setNewPostContent(e.target.value), placeholder: "¿Qué consejo ecológico quieres compartir hoy?", className: "w-full h-24 p-3 bg-hover rounded-lg border-none focus:ring-2 focus:ring-primary" }), React.createElement('div', { className: "text-right mt-4" }, React.createElement('button', { onClick: handlePost, className: "bg-primary text-dark-text font-semibold px-6 py-2 rounded-lg hover:bg-primary-dark transition" }, "Publicar"))), React.createElement('div', { className: "space-y-6" }, posts.map((p, i) => React.createElement(PostCard, { key: p.id, post: p, onLike: handleLike, onCommentSubmit: handleCommentSubmit, index: i })))); };
const PathDetailView = ({ path, onBack }) => { const { completeLearningStep, setActiveGame, appState, showToast } = useAppContext(); const [viewingLesson, setViewingLesson] = useState(null); const handleStepClick = (step) => { if(step.status === 'locked') { showToast('Completa los pasos anteriores para desbloquear este.', 'info'); return; } if(step.status === 'completed') { showToast('Ya has completado este paso.', 'info'); return; } switch(step.type) { case 'lesson': const lesson = lessons.find(l => l.id === step.itemId); if (lesson) { setViewingLesson(lesson); completeLearningStep(path.id, step.id); } break; case 'game': const game = appState.games.find(g => g.id === step.itemId); if (game) { const gameWithContext = { ...game, learningPathContext: { pathId: path.id, stepId: step.id } }; setActiveGame(gameWithContext); } break; case 'mission': const mission = appState.missions.find(m => m.id === step.itemId); if (mission && mission.progress && mission.progress.current >= mission.progress.total) { completeLearningStep(path.id, step.id); } else { showToast('Completa esta misión desde la página de Inicio para avanzar.', 'info'); } break; } }; const getStepIcon = (type) => ({'lesson': 'fa-solid fa-graduation-cap', 'game': 'fa-solid fa-gamepad', 'mission': 'fa-solid fa-flag-checkered'})[type]; const getStepStatusIcon = (status) => ({'completed': 'fa-solid fa-circle-check text-primary', 'available': 'fa-solid fa-play-circle text-secondary', 'locked': 'fa-solid fa-lock text-text-subtle'})[status]; return React.createElement('div', { className: "animate-fade-in" }, React.createElement('button', { onClick: onBack, className: "flex items-center gap-2 text-text-subtle font-semibold mb-6 hover:text-primary transition" }, React.createElement('i', { className: "fa-solid fa-arrow-left" }), " Volver a las Rutas"), React.createElement('div', { className: "bg-card p-6 rounded-xl shadow-sm" }, React.createElement('h3', { className: "text-2xl font-bold text-text mb-2" }, path.title), React.createElement('p', { className: "text-text-subtle mb-8" }, path.description), React.createElement('div', { className: "relative pl-6" }, React.createElement('div', { className: "absolute left-9 top-2 bottom-2 w-0.5 bg-border" }), path.steps.map((step, index) => React.createElement('div', { key: step.id, className: "relative mb-8 flex items-start gap-6" }, React.createElement('div', { className: `z-10 w-8 h-8 rounded-full flex items-center justify-center flex-shrink-0 ${step.status === 'locked' ? 'bg-border' : 'bg-primary'}`}, React.createElement('i', { className: `${getStepIcon(step.type)} text-sm ${step.status === 'locked' ? 'text-text-subtle' : 'text-white'}` })), React.createElement('div', { className: "flex-grow pt-1" }, React.createElement('h4', { className: "font-bold text-text" }, step.title), React.createElement('p', { className: "text-sm text-text-subtle mb-3" }, step.description), React.createElement('div', { className: "flex items-center gap-4" }, React.createElement('button', { onClick: () => handleStepClick(step), disabled: step.status === 'locked', className: `px-4 py-2 rounded-lg text-sm font-semibold transition flex items-center gap-2 ${step.status === 'locked' ? 'bg-hover text-text-subtle cursor-not-allowed' : 'bg-primary text-dark-text hover:bg-primary-dark'}` }, React.createElement('i', { className: `${getStepStatusIcon(step.status)} w-4 h-4` }), React.createElement('span', null, step.status === 'completed' ? 'Completado' : 'Empezar')), React.createElement('span', { className: "text-xs font-bold text-primary" }, `+${step.points} pts`)))))), path.isCompleted && React.createElement('div', { className: "mt-8 p-4 bg-primary/10 text-center rounded-lg border border-primary" }, React.createElement('i', { className: "fa-solid fa-trophy w-8 h-8 text-yellow-400 mb-2" }), React.createElement('h4', { className: "font-bold text-primary" }, "¡Ruta Completada!"), React.createElement('p', { className: "text-sm text-primary/80" }, `Has ganado ${path.rewardPoints} puntos de recompensa y un nuevo logro.`))), viewingLesson && React.createElement(LessonModal, { lesson: viewingLesson, onClose: () => setViewingLesson(null) })); };
const EducationPage = () => { const { appState, completeLearningStep } = useAppContext(); const [selectedPath, setSelectedPath] = useState(null); const updatedLearningPaths = useMemo(() => { return appState.learningPaths.map(path => { const newSteps = [...path.steps]; let needsUpdate = false; newSteps.forEach((step, index) => { if (step.type === 'mission' && step.status === 'available') { const mission = appState.missions.find(m => m.id === step.itemId); if (mission && mission.progress && mission.progress.current >= mission.progress.total) { completeLearningStep(path.id, step.id); needsUpdate = true; } } }); return needsUpdate ? appState.learningPaths.find(p => p.id === path.id) || path : path; }); }, [appState.learningPaths, appState.missions, completeLearningStep]); if(selectedPath) { const currentPathData = appState.learningPaths.find(p => p.id === selectedPath.id) || selectedPath; return React.createElement(PathDetailView, { path: currentPathData, onBack: () => setSelectedPath(null) }); } const LearningPathCard = ({ path, onSelect, index }) => { const progress = path.steps.filter(s => s.status === 'completed').length / path.steps.length * 100; return React.createElement('div', { onClick: onSelect, className: "bg-card rounded-xl shadow-sm overflow-hidden flex flex-col transition-all duration-300 hover:-translate-y-2 hover:shadow-xl animate-stagger-in cursor-pointer", style: { animationDelay: `${index * 100}ms` } }, React.createElement('div', { className: `flex items-center justify-center h-40 bg-gray-800 dark:bg-hover`}, React.createElement('i', { className: `${path.icon} text-6xl text-primary`, "aria-hidden": "true" })), React.createElement('div', { className: "p-6 flex flex-col flex-grow bg-card" }, React.createElement('h3', { className: "text-lg font-bold text-text" }, path.title), React.createElement('p', { className: "text-sm text-text-subtle mt-1 mb-4 flex-grow" }, path.description), React.createElement('div', { className: "w-full bg-hover rounded-full h-2.5 mb-2" }, React.createElement('div', { className: "bg-primary h-2.5 rounded-full", style:{width: `${progress}%`}})), React.createElement('p', { className: "text-xs text-text-subtle font-semibold" }, `${Math.round(progress)}% completado`))); }; return React.createElement(React.Fragment, null, React.createElement('h2', { className: "text-2xl font-bold text-text mb-2" }, "Rutas de Aprendizaje"), React.createElement('p', { className: "text-text-subtle mb-8" }, "Sigue un camino de aprendizaje, completa desafíos y conviértete en un experto en sostenibilidad."), React.createElement('div', { className: "grid grid-cols-1 md:grid-cols-2 xl:grid-cols-3 gap-8" }, appState.learningPaths.map((p, i) => React.createElement(LearningPathCard, { key: p.id, path: p, onSelect: () => setSelectedPath(p), index: i })))); };
const MinigamesPage = () => { const { isProUser, onProClick, consumeEnergy, appState, setActiveGame, showToast } = useAppContext(); const { energy, games, lastEnergyRecharge } = appState; const [countdown, setCountdown] = useState(''); useEffect(() => { let timerInterval = null; const ENERGY_RECHARGE_RATE = 15 * 60 * 1000; const updateTimer = () => { if(appState.energy >= 5) { setCountdown(''); if(timerInterval) clearInterval(timerInterval); return; } const nextRechargeTime = appState.lastEnergyRecharge + ENERGY_RECHARGE_RATE; const remainingTime = nextRechargeTime - Date.now(); if (remainingTime > 0) { const minutes = Math.floor(remainingTime / (1000 * 60)); const seconds = Math.floor((remainingTime % (1000 * 60)) / 1000); setCountdown(`${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`); } else { setCountdown('Recargando...'); } }; updateTimer(); timerInterval = window.setInterval(updateTimer, 1000); return () => { if (timerInterval) clearInterval(timerInterval); }; }, [appState.energy, appState.lastEnergyRecharge]); const handleGameClick = (game) => { if (game.isPro && !isProUser) { onProClick(); return; } consumeEnergy((success) => { if (success) setActiveGame(game); else showToast("¡No tienes suficiente energía!", "error"); }); }; return React.createElement(React.Fragment, null, React.createElement('h2', { className: "text-2xl font-bold text-text mb-2" }, "Centro de Minijuegos"), React.createElement('p', { className: "text-text-subtle mb-8" }, `Diviértete, aprende y gana puntos. ¡Tienes ${energy} intentos!`), React.createElement('div', { className: "bg-card p-6 rounded-xl shadow-sm mb-8 flex items-center justify-between" }, React.createElement('div', { className: "flex items-center gap-3" }, React.createElement('i', { className: "fa-solid fa-bolt text-4xl text-yellow-500" }), React.createElement('div', null, React.createElement('h3', { className: "text-lg font-bold text-text" }, "Tu Energía"), React.createElement('p', { className: "text-sm text-text-subtle" }, energy < 5 && countdown ? `Próxima en ${countdown}` : 'Energía al máximo'))), React.createElement('div', { className: "flex items-center gap-2" }, [...Array(5)].map((_, i) => React.createElement('i', { key: i, className: `fa-solid fa-bolt text-2xl transition-colors ${i < energy ? 'text-yellow-400' : 'text-border'}` })))), React.createElement('div', { className: "grid grid-cols-1 md:grid-cols-2 xl:grid-cols-3 gap-8" }, games.map((g, i) => React.createElement(GameCard, { key: g.id, game: g, index: i, isProUser: isProUser, onGameClick: () => handleGameClick(g) })))); };
const ImpactChart = () => { const impactData = [ { month: 'Ene', co2: 12 }, { month: 'Feb', co2: 18 }, { month: 'Mar', co2: 25 }, { month: 'Abr', co2: 22 }, { month: 'May', co2: 30 }, { month: 'Jun', co2: 45 }, ]; const maxCo2 = Math.max(...impactData.map(d => d.co2), 0) * 1.1; return React.createElement('div', { className: "animate-fade-in" }, React.createElement('h3', { className: "text-xl font-bold mb-2" }, "Impacto Ambiental (CO2 Reducido)"), React.createElement('p', { className: "text-text-subtle mb-8" }, "Tu progreso en los últimos 6 meses."), React.createElement('div', { className: "w-full h-80 bg-hover p-4 rounded-lg flex items-end justify-around gap-2", "aria-label": "Gráfico de barras del impacto ambiental" }, impactData.map(data => React.createElement('div', { key: data.month, className: "flex flex-col items-center flex-grow h-full justify-end" }, React.createElement('div', { className: "w-full h-full flex items-end justify-center group" }, React.createElement('div', { className: "w-3/4 bg-primary rounded-t-md hover:opacity-80 transition-all duration-300 relative", style: { height: `${(data.co2 / (maxCo2 || 1)) * 100}%` }, role: "progressbar", "aria-valuenow": data.co2, "aria-valuemin": 0, "aria-valuemax": maxCo2, "aria-label": `${data.co2} kg de CO2 reducido en ${data.month}` }, React.createElement('div', { className: "absolute -top-7 left-1/2 -translate-x-1/2 bg-gray-900 text-white text-xs rounded py-1 px-2 opacity-0 group-hover:opacity-100 transition-opacity whitespace-nowrap" }, `${data.co2} kg`))), React.createElement('span', { className: "mt-2 text-sm font-semibold text-text-subtle" }, data.month))))); };
const AchievementsList = () => { const { appState } = useAppContext(); const achievements = [ {id:'a1', name:'Primeros Pasos', description: 'Completa tu primer escaneo de producto reciclable', icon: 'fa-solid fa-qrcode', isUnlocked: true, unlockDate: '12/05/2023', difficulty: 'Fácil'}, {id:'a2', name:'Aprendiz de Eco', description: 'Completa tu primera lección educativa', icon: 'fa-solid fa-graduation-cap', isUnlocked: true, unlockDate: '13/05/2023', difficulty: 'Fácil'}, {id:'a3', name:'Socialité', description: 'Publica tu primer consejo en la comunidad', icon: 'fa-solid fa-users', isUnlocked: true, unlockDate: '15/05/2023', difficulty: 'Fácil'}, {id:'a4', name:'Juguetón', description: 'Juega tu primer minijuego', icon: 'fa-solid fa-gamepad', isUnlocked: true, unlockDate: '16/05/2023', difficulty: 'Fácil'}, {id:'a5', name:'Comprador Consciente', description: 'Canjea tu primera recompensa en la tienda', icon: 'fa-solid fa-store', isUnlocked: false, difficulty: 'Fácil', progress: {current: 0, total: 1}}, {id:'a6', name:'Racha de 3 Días', description: 'Inicia sesión en la app por 3 días seguidos', icon: 'fa-solid fa-calendar-days', isUnlocked: false, progress: {current: 1, total: 3}, difficulty: 'Fácil'}, {id:'a7', name:'Curioso', description: 'Visita todas las secciones principales de la app', icon: 'fa-solid fa-compass', isUnlocked: true, unlockDate: '18/05/2023', difficulty: 'Fácil'}, {id:'a8', name:'Buen Samaritano', description: 'Dale "Me gusta" a 5 publicaciones en la comunidad', icon: 'fa-solid fa-thumbs-up', isUnlocked: false, progress: {current: 2, total: 5}, difficulty: 'Fácil'}, {id:'ach-lp1', name:'Guardián del Plástico', description: 'Completa la ruta de aprendizaje sobre plásticos.', icon: 'fa-solid fa-shield-halved', isUnlocked: appState.learningPaths.find(p => p.id === 'lp1')?.isCompleted || false, unlockDate: 'Hoy', difficulty: 'Intermedio'}, {id:'ach-lp2', name:'Maestro del Compostaje', description: 'Completa la ruta de aprendizaje sobre compostaje.', icon: 'fa-solid fa-leaf', isUnlocked: appState.learningPaths.find(p => p.id === 'lp2')?.isCompleted || false, unlockDate: 'Hoy', difficulty: 'Intermedio'}, {id:'a9', name:'Reciclador Novato', description: 'Recicla 25 productos diferentes', icon: 'fa-solid fa-recycle', isUnlocked: true, unlockDate: '20/05/2023', difficulty: 'Intermedio'}, {id:'a10', name:'Estudiante Aplicado', description: 'Completa 5 lecciones educativas', icon: 'fa-solid fa-book-open', isUnlocked: false, progress: {current: 2, total: 5}, difficulty: 'Intermedio'}, {id:'a11', name:'Racha de una Semana', description: 'Inicia sesión en la app por 7 días seguidos', icon: 'fa-solid fa-calendar-week', isUnlocked: false, progress: {current: 1, total: 7}, difficulty: 'Intermedio'}, {id:'a13', name:'Acumulador de Puntos', description: 'Alcanza los 2,500 puntos EcoPuntos', icon: 'fa-solid fa-coins', isUnlocked: false, progress: {current: appState.stats.points, total: 2500}, difficulty: 'Intermedio'}, {id:'a15', name:'Conversador', description: 'Deja 10 comentarios en la comunidad', icon: 'fa-solid fa-comments', isUnlocked: false, progress: {current: 3, total: 10}, difficulty: 'Intermedio'}, {id:'a16', name:'Guardabosques', description: 'Planta un árbol a través de la tienda EcoPuntos', icon: 'fa-solid fa-tree', isUnlocked: false, difficulty: 'Intermedio'}, {id:'a19', name:'Reciclador Avanzado', description: 'Recicla 100 productos diferentes', icon: 'fa-solid fa-award', isUnlocked: false, progress: {current: 25, total: 100}, difficulty: 'Difícil'}, {id:'a20', name:'EcoHéroe', description: 'Alcanza los 5,000 puntos EcoPuntos', icon: 'fa-solid fa-trophy', isUnlocked: false, progress: {current: appState.stats.points, total: 5000}, difficulty: 'Difícil'}, {id:'a21', name:'Top 100 Nacional', description: 'Alcanza el top 100 del ranking nacional', icon: 'fa-solid fa-star', isUnlocked: true, unlockDate: '05/06/2023', difficulty: 'Difícil'}, {id:'a22', name:'Coleccionista Pro', description: 'Desbloquea todos los minijuegos Pro', icon: 'fa-solid fa-crown', isUnlocked: false, difficulty: 'Difícil'}, {id:'a23', name:'Súper Fan', description: 'Canjea 5 recompensas diferentes en la tienda', icon: 'fa-solid fa-cart-shopping', isUnlocked: false, progress: {current: 1, total: 5}, difficulty: 'Difícil'}, {id:'a24', name:'Cerebrito', description: 'Completa todas las lecciones educativas', icon: 'fa-solid fa-brain', isUnlocked: false, difficulty: 'Difícil'}, {id:'a25', name:'Racha de un Mes', description: 'Inicia sesión en la app por 30 días seguidos', icon: 'fa-solid fa-calendar', isUnlocked: false, progress: {current: 1, total: 30}, difficulty: 'Difícil'}, {id:'a28', name:'Maestro del Reciclaje', description: 'Recicla 500 productos', icon: 'fa-solid fa-shield-halved', isUnlocked: false, progress: {current: 25, total: 500}, difficulty: 'Experto'}, {id:'a29', name:'Leyenda Ecológica', description: 'Alcanza los 10,000 puntos EcoPuntos', icon: 'fa-solid fa-gem', isUnlocked: false, progress: {current: appState.stats.points, total: 10000}, difficulty: 'Experto'}, {id:'a30', name:'Top 10 Nacional', description: 'Alcanza el top 10 del ranking nacional', icon: 'fa-solid fa-meteor', isUnlocked: false, difficulty: 'Experto'}, {id:'a31', name:'Compromiso Total', description: 'Mantén una racha de 100 días de inicio de sesión', icon: 'fa-solid fa-infinity', isUnlocked: false, progress: {current: 1, total: 100}, difficulty: 'Experto'}, ]; const groupedAchievements = achievements.sort((a,b) => (a.isUnlocked === b.isUnlocked) ? 0 : a.isUnlocked ? -1 : 1).reduce((acc, ach) => { const diff = ach.difficulty; if (!acc[diff]) acc[diff] = []; acc[diff].push(ach); return acc; }, {}); const difficultyOrder = ['Fácil', 'Intermedio', 'Difícil', 'Experto']; const difficultyColors = { 'Fácil': 'border-green-500', 'Intermedio': 'border-blue-500', 'Difícil': 'border-purple-500', 'Experto': 'border-yellow-500' }; return React.createElement('div', { className: "animate-fade-in space-y-8" }, difficultyOrder.map(difficulty => (groupedAchievements[difficulty] && React.createElement('div', { key: difficulty }, React.createElement('h3', { className: `text-xl font-bold mb-4 border-l-4 pl-3 ${difficultyColors[difficulty]}` }, difficulty), React.createElement('div', { className: "grid grid-cols-2 sm:grid-cols-3 lg:grid-cols-4 gap-4" }, groupedAchievements[difficulty].map((a, i) => React.createElement(AchievementCard, { key: a.id, ach: a, index: i }))))))); };
const FullHistory = () => { const { appState } = useAppContext(); return React.createElement('div', { className: "animate-fade-in" }, React.createElement('h3', { className: "text-xl font-bold mb-4" }, "Historial Completo"), React.createElement('div', null, appState.history.map((item, i) => React.createElement(HistoryLogItem, { key: item.id, item: item, index: i })))); };
const ProfilePage = ({ onSettingsClick }) => { const { user, appState } = useAppContext(); const [activeTab, setActiveTab] = useState('logros'); const renderTabContent = () => { switch (activeTab) { case 'impacto': return React.createElement(ImpactChart, null); case 'logros': return React.createElement(AchievementsList, null); case 'historial': return React.createElement(FullHistory, null); default: return null; } }; return React.createElement(React.Fragment, null, React.createElement('div', { className: "bg-card p-8 rounded-xl shadow-sm mb-8 flex flex-col md:flex-row items-center gap-8" }, React.createElement('div', { className: "w-24 h-24 bg-primary rounded-full flex items-center justify-center text-dark-text text-4xl font-bold flex-shrink-0" }, user.initials), React.createElement('div', { className: "text-center md:text-left" }, React.createElement('h2', { className: "text-3xl font-bold text-text" }, user.name), React.createElement('p', { className: "text-text-subtle" }, user.location), React.createElement('div', { className: "flex items-center justify-center md:justify-start gap-6 my-4" }, React.createElement('div', null, React.createElement('span', { className: "text-2xl font-bold text-primary" }, appState.stats.points.toLocaleString()), React.createElement('p', { className: "text-sm text-text-subtle" }, "Puntos")), React.createElement('div', null, React.createElement('span', { className: "text-2xl font-bold text-primary" }, `${appState.stats.impact} kg`), React.createElement('p', { className: "text-sm text-text-subtle" }, "CO2 reducido")), React.createElement('div', null, React.createElement('span', { className: "text-2xl font-bold text-primary" }, `#${appState.stats.rank}`), React.createElement('p', { className: "text-sm text-text-subtle" }, "Ranking"))), React.createElement('div', { className: "flex gap-4" }, React.createElement('button', { className: "px-6 py-2 bg-primary text-dark-text rounded-lg font-semibold flex items-center gap-2 hover:bg-primary-dark" }, React.createElement('i', { className: "fa-solid fa-share w-5 h-5" }), "Compartir"), React.createElement('button', { onClick: onSettingsClick, className: "px-6 py-2 bg-hover text-text rounded-lg font-semibold flex items-center gap-2 hover:bg-border" }, React.createElement('i', { className: "fa-solid fa-gear w-5 h-5" }), "Configuración")))), React.createElement('div', { className: "bg-card p-8 rounded-xl shadow-sm" }, React.createElement('div', { className: "flex border-b border-border mb-6 overflow-x-auto" }, React.createElement('button', { onClick: () => setActiveTab('impacto'), className: `px-4 sm:px-6 py-3 font-semibold transition-colors duration-200 whitespace-nowrap ${activeTab === 'impacto' ? 'border-b-2 border-primary text-primary' : 'text-text-subtle hover:text-text'}` }, "Impacto"), React.createElement('button', { onClick: () => setActiveTab('logros'), className: `px-4 sm:px-6 py-3 font-semibold transition-colors duration-200 whitespace-nowrap ${activeTab === 'logros' ? 'border-b-2 border-primary text-primary' : 'text-text-subtle hover:text-text'}` }, "Logros"), React.createElement('button', { onClick: () => setActiveTab('historial'), className: `px-4 sm:px-6 py-3 font-semibold transition-colors duration-200 whitespace-nowrap ${activeTab === 'historial' ? 'border-b-2 border-primary text-primary' : 'text-text-subtle hover:text-text'}` }, "Historial")), renderTabContent())); };
const RankingPage = () => { const { user: currentUser, appState } = useAppContext(); const [activeTab, setActiveTab] = useState('local'); const currentUserCity = currentUser.location.split(',')[0] || 'Lima'; const rankedData = useMemo(() => { const currentUserEntry = { user: { name: currentUser.name, initials: currentUser.initials, location: currentUserCity }, points: appState.stats.points, isCurrentUser: true, }; const nationalUserMap = new Map(mockUsers.map(u => [u.user.name, u])); nationalUserMap.set(currentUserEntry.user.name, currentUserEntry); const nacionalData = Array.from(nationalUserMap.values()).sort((a, b) => b.points - a.points).map((entry, index) => ({ ...entry, rank: index + 1 })); const localUserMap = new Map(mockUsers.filter(u => u.user.location === currentUserCity).map(u => [u.user.name, u])); localUserMap.set(currentUserEntry.user.name, currentUserEntry); const localData = Array.from(localUserMap.values()).sort((a, b) => b.points - a.points).map((entry, index) => ({ ...entry, rank: index + 1 })); return { local: localData, nacional: nacionalData }; }, [currentUser, appState.stats.points]); const data = activeTab === 'local' ? rankedData.local : rankedData.nacional; return React.createElement(React.Fragment, null, React.createElement('h2', { className: "text-2xl font-bold text-text mb-2" }, "Ranking de Usuarios"), React.createElement('p', { className: "text-text-subtle mb-8" }, "Compara tu progreso con otros usuarios y motívate para subir de posición. Los mejores recicladores ganan premios especiales."), React.createElement('div', { className: "flex border-b border-border mb-6" }, React.createElement('button', { onClick: () => setActiveTab('local'), className: `px-6 py-3 font-semibold ${activeTab === 'local' ? 'border-b-2 border-primary text-primary' : 'text-text-subtle'}` }, `Local (${currentUserCity})`), React.createElement('button', { onClick: () => setActiveTab('nacional'), className: `px-6 py-3 font-semibold ${activeTab === 'nacional' ? 'border-b-2 border-primary text-primary' : 'text-text-subtle'}` }, "Nacional (Perú)")), React.createElement('div', { className: "bg-card rounded-xl shadow-sm" }, React.createElement('div', { className: "flex items-center p-4 text-sm font-semibold text-text-subtle border-b border-border" }, React.createElement('div', { className: "w-12 text-center" }, "#"), React.createElement('div', { className: "w-12" }), React.createElement('div', { className: "flex-grow" }, "Usuario"), React.createElement('div', { className: "w-32 text-right" }, "Puntos")), React.createElement('div', { className: "space-y-1 p-2" }, data.map((entry, i) => React.createElement(RankRow, { key: `${activeTab}-${entry.user.name}`, entry: entry, index: i }))))); };
const ScannerPage = () => { const { updatePoints } = useAppContext(); const [isCameraActive, setCameraActive] = useState(false); const [isScanning, setIsScanning] = useState(false); const [scanMessage, setScanMessage] = useState(''); const [error, setError] = useState(null); const [searchText, setSearchText] = useState(""); const videoRef = useRef(null); const streamRef = useRef(null); const filteredProducts = useMemo(() => products.filter(p => p.name.toLowerCase().includes(searchText.toLowerCase())), [searchText]); const stopCamera = useCallback(() => { if (streamRef.current) { streamRef.current.getTracks().forEach(track => track.stop()); streamRef.current = null; } if (videoRef.current) { videoRef.current.srcObject = null; } setCameraActive(false); setIsScanning(false); }, []); const handleActivateCamera = useCallback(async () => { if (isCameraActive || isScanning) { stopCamera(); return; } setError(null); setScanMessage(''); try { const stream = await navigator.mediaDevices.getUserMedia({ video: { facingMode: 'environment' } }); streamRef.current = stream; if (videoRef.current) { videoRef.current.srcObject = stream; videoRef.current.onloadedmetadata = () => { videoRef.current?.play(); setCameraActive(true); setIsScanning(true); setTimeout(() => { stopCamera(); const scannedProduct = products.find(p => p.name === 'Botella de vidrio'); if (scannedProduct) { setScanMessage(`¡Producto escaneado! "${scannedProduct.name}". Has ganado ${scannedProduct.points} puntos.`); updatePoints(scannedProduct.points, `Escaneo: ${scannedProduct.name}`); } }, 3000); } } } catch (err) { console.error("Error accessing camera:", err); setError("No se pudo acceder a la cámara. Asegúrate de haber otorgado los permisos necesarios en tu navegador."); stopCamera(); } }, [isCameraActive, isScanning, stopCamera, updatePoints]); useEffect(() => { return () => stopCamera(); }, [stopCamera]); return React.createElement(React.Fragment, null, React.createElement('div', { className: "bg-card p-8 rounded-xl shadow-sm mb-8" }, React.createElement('h2', { className: "text-xl font-bold text-text mb-2" }, "Escanea un producto reciclable"), React.createElement('p', { className: "text-text-subtle mb-6" }, "Apunta con la cámara al código de barras del producto para obtener puntos."), React.createElement('div', { className: "w-full h-96 bg-gray-900 dark:bg-black rounded-lg flex flex-col items-center justify-center text-white relative overflow-hidden" }, React.createElement('video', { ref: videoRef, autoPlay: true, playsInline: true, muted: true, className: `absolute top-0 left-0 w-full h-full object-cover transition-opacity duration-300 ${isCameraActive ? 'opacity-100' : 'opacity-0'}` }), isScanning && React.createElement('div', { className: "absolute inset-0 z-10 pointer-events-none" }, React.createElement('div', { className: "absolute top-0 left-0 w-full h-1.5 bg-primary animate-scan" })), !isCameraActive && React.createElement('div', { className: "z-20 flex flex-col items-center justify-center text-center p-4" }, React.createElement('i', { className: "fa-solid fa-camera text-7xl mb-4", "aria-hidden": "true" }), React.createElement('button', { onClick: handleActivateCamera, className: "bg-primary text-dark-text font-semibold px-6 py-2 rounded-lg hover:bg-primary-dark transition" }, "Activar Cámara"))), scanMessage && React.createElement('div', { className: "mt-4 p-4 text-center bg-primary/10 text-primary rounded-lg animate-fade-in" }, scanMessage), error && React.createElement('div', { className: "mt-4 p-4 text-center bg-red-500/10 text-red-500 rounded-lg animate-fade-in" }, error)), React.createElement('div', { className: "bg-card p-8 rounded-xl shadow-sm" }, React.createElement('h2', { className: "text-xl font-bold text-text mb-4" }, "Productos Reciclables"), React.createElement('div', { className: "relative mb-6" }, React.createElement('i', { className: "fa-solid fa-magnifying-glass absolute left-4 top-1/2 -translate-y-1/2 w-5 h-5 text-text-subtle", "aria-hidden": "true" }), React.createElement('input', { type: "text", placeholder: "Buscar producto...", value: searchText, onChange: e => setSearchText(e.target.value), className: "w-full bg-hover border-none rounded-lg py-3 pl-12 pr-4 focus:ring-2 focus:ring-primary" })), React.createElement('div', { className: "grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 xl:grid-cols-6 gap-4" }, filteredProducts.map((p,i) => React.createElement('div', { key: p.id, className: "text-center p-4 bg-hover rounded-lg flex flex-col items-center justify-between transition-transform duration-300 hover:-translate-y-1 animate-stagger-in", style: { animationDelay: `${i * 30}ms` } }, React.createElement('i', { className: `${p.icon} text-3xl text-primary mb-2`, "aria-hidden": "true" }), React.createElement('p', { className: "font-semibold text-sm text-text" }, p.name), React.createElement('p', { className: "text-xs text-text-subtle" }, p.category), React.createElement('span', { className: "mt-2 text-xs font-bold text-primary" }, `+${p.points} pts`)))))); };
const StorePage = () => { const { appState, updatePoints, showToast } = useAppContext(); const handleRedeem = (reward) => { if (appState.stats.points >= reward.points) { updatePoints(-reward.points, `Canje: ${reward.name}`); showToast(`¡Has canjeado "${reward.name}"!`, 'success'); } else { showToast("No tienes suficientes puntos.", 'error'); } }; return React.createElement(React.Fragment, null, React.createElement('h2', { className: "text-2xl font-bold text-text mb-2" }, "Tienda de Recompensas"), React.createElement('p', { className: "text-text-subtle mb-6" }, "Canjea tus puntos EcoPuntos por recompensas sostenibles."), React.createElement('div', { className: "bg-primary/10 text-primary-dark dark:text-primary p-4 rounded-lg flex items-center gap-4 mb-8" }, React.createElement('i', { className: "fa-solid fa-tree w-10 h-10 text-4xl" }), React.createElement('div', null, React.createElement('h4', { className: "font-bold" }, "¡Doble Impacto!"), React.createElement('p', { className: "text-sm" }, "Cada producto que canjeas también aporta una donación para plantar un árbol en el Amazonas."))), React.createElement('div', { className: "grid grid-cols-1 md:grid-cols-2 xl:grid-cols-3 gap-8" }, rewards.map((r, i) => React.createElement(RewardCard, { key: r.id, reward: r, onRedeem: handleRedeem, index: i })))); };

// --- START: components/layout ---
const NavItem = ({ item, isActive = false, isCollapsed, isPro, onClick }) => { return React.createElement('li', null, React.createElement('a', { href: "#", onClick: (e) => { e.preventDefault(); onClick(); }, className: `flex items-center rounded-lg transition-colors duration-200 ${ isCollapsed ? "justify-center w-14 h-14" : `py-3 gap-4 border-l-4 pl-3 pr-4 ${isActive ? 'border-primary' : 'border-transparent'}` } ${ isActive ? "bg-sidebar-hover text-white" : "text-sidebar-text hover:bg-sidebar-hover hover:text-white" }`, title: item.name, "aria-label": item.name }, React.createElement('div', { className: "flex items-center justify-center flex-shrink-0 w-8" }, React.createElement('i', { className: `${item.icon} transition-all duration-200 ${isCollapsed ? 'h-7 w-7 text-2xl' : 'h-6 w-6 text-xl'}`, "aria-hidden": "true" })), React.createElement('span', { className: `text-lg font-medium transition-all duration-200 ease-in-out ${isCollapsed ? 'opacity-0 w-0' : 'opacity-100 w-auto'}` }, item.name), isPro && !isCollapsed && React.createElement('i', { className: "fa-solid fa-crown h-5 w-5 text-yellow-400 ml-auto", "aria-hidden": "true" }))); };
const Sidebar = ({ activePage, onNavItemClick, isCollapsed, onToggleCollapse, isDarkMode, onToggleDarkMode, onLogout, isProUser, onProClick, isMobileMenuOpen }) => { const secondaryNavActions = [ { name: 'Cerrar Sesión', icon: 'fa-solid fa-right-from-bracket', action: onLogout }, { name: isProUser ? 'Eres Pro' : 'Modo Pro', icon: 'fa-solid fa-crown', action: onProClick, isPro: isProUser }, { name: isDarkMode ? 'Modo Claro' : 'Modo Oscuro', icon: isDarkMode ? 'fa-solid fa-sun' : 'fa-solid fa-moon', action: onToggleDarkMode }, ]; return React.createElement('aside', { className: `bg-sidebar text-white flex flex-col h-screen p-4 fixed lg:relative z-40 transition-all duration-300 ease-in-out w-72 ${isCollapsed ? 'lg:w-24' : 'lg:w-72'} ${isMobileMenuOpen ? 'translate-x-0' : '-translate-x-full'} lg:translate-x-0` }, React.createElement('button', { onClick: onToggleCollapse, "aria-label": "Toggle Sidebar", className: `w-full flex items-center text-sidebar-text hover:text-white focus:outline-none mb-4 pb-3 border-b border-sidebar-hover ${isCollapsed ? 'justify-center' : 'justify-between'}` }, React.createElement('div', { className: "flex items-center gap-4 overflow-hidden" }, React.createElement('i', { className: "fa-solid fa-leaf text-4xl text-primary flex-shrink-0", "aria-hidden": "true" }), React.createElement('span', { className: `text-3xl font-bold whitespace-nowrap transition-opacity duration-200 ${isCollapsed ? 'opacity-0' : 'opacity-100'}` }, "EcoPuntos")), React.createElement('div', { className: "hidden lg:block" }, React.createElement('i', { className: `fa-solid fa-chevron-left h-5 w-5 transition-transform duration-300 ${isCollapsed ? 'rotate-180' : 'rotate-0'}`, "aria-hidden": "true" }))), React.createElement('nav', { className: "flex-grow" }, React.createElement('ul', { className: "space-y-2" }, mainNavItems.map((item) => React.createElement(NavItem, { key: item.name, item: item, isActive: activePage === item.name, isCollapsed: isCollapsed, onClick: () => onNavItemClick(item.name) })))), React.createElement('div', null, React.createElement('ul', { className: "space-y-2 border-t border-border pt-4" }, secondaryNavActions.map((item) => React.createElement(NavItem, { key: item.name, item: {name: item.name, icon: item.icon}, isCollapsed: isCollapsed, onClick: item.action, isPro: item.isPro }))))); };
const MainContent = ({ activePage, onNavItemClick, isSidebarCollapsed, onMobileMenuToggle }) => { const { user } = useAppContext(); const [isDropdownOpen, setDropdownOpen] = useState(false); const [showSettings, setShowSettings] = useState(false); const dropdownRef = useRef(null); useEffect(() => { const handleClickOutside = (event) => { if (dropdownRef.current && !dropdownRef.current.contains(event.target)) setDropdownOpen(false); }; document.addEventListener("mousedown", handleClickOutside); return () => document.removeEventListener("mousedown", handleClickOutside); }, []); const handleProfileClick = () => { onNavItemClick('Perfil'); setDropdownOpen(false); }; const handleSettingsClick = () => { setShowSettings(true); setDropdownOpen(false); }; const renderPage = () => { switch (activePage) { case 'Inicio': return React.createElement(HomePage, null); case 'Escáner': return React.createElement(ScannerPage, null); case 'Tienda': return React.createElement(StorePage, null); case 'Educación': return React.createElement(EducationPage, null); case 'Minijuegos': return React.createElement(MinigamesPage, null); case 'Comunidad': return React.createElement(CommunityPage, null); case 'Ranking': return React.createElement(RankingPage, null); case 'Perfil': return React.createElement(ProfilePage, { onSettingsClick: handleSettingsClick }); default: return React.createElement('div', { className: "text-center py-20" }, React.createElement('h1', { className: "text-4xl font-bold" }, activePage), React.createElement('p', null, "Página en construcción.")); } }; return React.createElement('main', { className: `flex-1 bg-background p-4 sm:p-8 overflow-y-auto transition-all duration-300 ease-in-out` }, React.createElement('header', { className: "lg:hidden flex justify-between items-center mb-6" }, React.createElement('button', { onClick: onMobileMenuToggle, className: "text-text hover:text-primary" }, React.createElement('i', { className: "fa-solid fa-bars text-2xl w-8 h-8" })), React.createElement('h1', { className: "text-2xl font-bold text-primary" }, activePage), React.createElement('div', { className: "relative", ref: dropdownRef }, React.createElement('button', { onClick: () => setDropdownOpen(!isDropdownOpen), className: "flex items-center" }, React.createElement('div', { className: "w-9 h-9 bg-primary rounded-full flex items-center justify-center text-dark-text font-bold" }, user.initials)), isDropdownOpen && React.createElement('div', { className: "absolute right-0 mt-2 w-56 bg-card rounded-lg shadow-xl z-20 py-1 border border-border animate-fade-in-down" }, React.createElement('button', { onClick: handleProfileClick, className: "w-full text-left flex items-center gap-3 px-4 py-2 text-sm text-text hover:bg-hover" }, React.createElement('i', { className: "fa-solid fa-user w-5 h-5" }), " Mi Perfil"), React.createElement('button', { onClick: handleSettingsClick, className: "w-full text-left flex items-center gap-3 px-4 py-2 text-sm text-text hover:bg-hover" }, React.createElement('i', { className: "fa-solid fa-gear w-5 h-5" }), " Ajustes")))), React.createElement('header', { className: "hidden lg:flex justify-between items-center mb-8" }, React.createElement('h1', { className: "text-4xl font-bold text-primary" }, activePage), React.createElement('div', { className: "relative", ref: dropdownRef }, React.createElement('button', { onClick: () => setDropdownOpen(!isDropdownOpen), className: "flex items-center gap-3 bg-card px-3 py-2 rounded-full shadow-sm cursor-pointer transition-shadow hover:shadow-md" }, React.createElement('div', { className: "w-9 h-9 bg-primary rounded-full flex items-center justify-center text-dark-text font-bold" }, user.initials), React.createElement('span', { className: "font-semibold text-text hidden sm:block" }, user.name), React.createElement('i', { className: `fa-solid fa-chevron-down h-5 w-5 text-text-subtle transition-transform duration-200 ${isDropdownOpen ? 'rotate-180' : ''}` })), isDropdownOpen && React.createElement('div', { className: "absolute right-0 mt-2 w-56 bg-card rounded-lg shadow-xl z-20 py-1 border border-border animate-fade-in-down" }, React.createElement('button', { onClick: handleProfileClick, className: "w-full text-left flex items-center gap-3 px-4 py-2 text-sm text-text hover:bg-hover" }, React.createElement('i', { className: "fa-solid fa-user w-5 h-5" }), " Mi Perfil"), React.createElement('button', { onClick: handleSettingsClick, className: "w-full text-left flex items-center gap-3 px-4 py-2 text-sm text-text hover:bg-hover" }, React.createElement('i', { className: "fa-solid fa-gear w-5 h-5" }), " Ajustes")))), React.createElement('div', { className: "animate-fade-in" }, renderPage()), showSettings && React.createElement(SettingsModal, { onClose: () => setShowSettings(false) })); };
const AppLayout = ({ onLogout }) => { const { isProUser, onProClick, activeGame, setActiveGame, updatePoints, setAppState, completeLearningStep } = useAppContext(); const [isDarkMode, setDarkMode] = usePersistentState('isDarkMode', false); const [activePage, setActivePage] = useState('Inicio'); const [isSidebarCollapsed, setSidebarCollapsed] = usePersistentState('isSidebarCollapsed', false); const [isMobileMenuOpen, setMobileMenuOpen] = useState(false); useEffect(() => { document.documentElement.classList.toggle('dark', isDarkMode); }, [isDarkMode]); const handleNavItemClick = (page) => { setActivePage(page); setMobileMenuOpen(false); }; const handleGameEnd = (score) => { if (!activeGame) return; const finalScore = activeGame.isDailyChallenge ? score * 2 : score; updatePoints(finalScore, `Juego: ${activeGame.title}`); setAppState(prev => ({ ...prev, games: prev.games.map(g => g.id === activeGame.id && score > g.highScore ? { ...g, highScore: score } : g) })); if (activeGame.learningPathContext) { completeLearningStep(activeGame.learningPathContext.pathId, activeGame.learningPathContext.stepId); } setActiveGame(null); }; const renderActiveGame = () => { if (!activeGame) return null; let GameComponent; switch (activeGame.id) { case 'g1': GameComponent = EcoQuizGame; break; case 'g2': GameComponent = MemoryGame; break; case 'g3': GameComponent = SortTheTrashGame; break; case 'g4': GameComponent = LightsOutGame; break; case 'g5': GameComponent = EcoAnagramsGame; break; default: GameComponent = () => React.createElement('div', null, "Juego no encontrado"); } return React.createElement(GameContainer, { title: activeGame.title, onExit: () => setActiveGame(null) }, React.createElement(GameComponent, { onGameEnd: handleGameEnd })); }; return React.createElement(React.Fragment, null, isMobileMenuOpen && React.createElement('div', { className: "fixed inset-0 bg-black/60 z-30 lg:hidden", onClick: () => setMobileMenuOpen(false), "aria-hidden": "true" }), React.createElement('div', { className: "flex bg-background h-screen overflow-hidden" }, React.createElement(Sidebar, { activePage: activePage, onNavItemClick: handleNavItemClick, isCollapsed: isSidebarCollapsed, onToggleCollapse: () => setSidebarCollapsed(!isSidebarCollapsed), isDarkMode: isDarkMode, onToggleDarkMode: () => setDarkMode(!isDarkMode), onLogout: onLogout, isProUser: isProUser, onProClick: onProClick, isMobileMenuOpen: isMobileMenuOpen }), React.createElement(MainContent, { activePage: activePage, onNavItemClick: setActivePage, isSidebarCollapsed: isSidebarCollapsed, onMobileMenuToggle: () => setMobileMenuOpen(true) })), renderActiveGame()); };

// --- START: App.tsx ---
const AppContent = () => { const { showToast } = useToast(); const [isLoggedIn, setLoggedIn] = usePersistentState('isLoggedIn', false); const [user, setUser] = usePersistentState('user', MOCK_USER); const [isProUser, setProUser] = usePersistentState('isProUser', false); const [appState, setAppState] = usePersistentState('appState', INITIAL_APP_STATE); const [showProModal, setShowProModal] = useState(false); const [activeGame, setActiveGame] = useState(null); useEffect(() => { const rechargeEnergy = () => { setAppState(prev => { if (prev.energy >= 5) return prev; const now = Date.now(); const ENERGY_RECHARGE_RATE = 15 * 60 * 1000; const timeDiff = now - prev.lastEnergyRecharge; const energyToRecharge = Math.floor(timeDiff / ENERGY_RECHARGE_RATE); if (energyToRecharge > 0) { const newEnergy = Math.min(prev.energy + energyToRecharge, 5); const newLastRecharge = prev.lastEnergyRecharge + (energyToRecharge * ENERGY_RECHARGE_RATE); return { ...prev, energy: newEnergy, lastEnergyRecharge: newLastRecharge }; } return prev; }); }; rechargeEnergy(); const energyInterval = setInterval(rechargeEnergy, 60 * 1000); return () => clearInterval(energyInterval); }, [setAppState]); const handleLogin = () => setLoggedIn(true); const handleLogout = () => setLoggedIn(false); const handleProClick = () => { if (isProUser) { showToast("¡Ya eres un miembro Pro! Gracias por tu apoyo.", 'info'); } else { setShowProModal(true); } }; const updatePoints = useCallback((points, description) => { setAppState(prev => { const newHistoryItem = { id: `h${Date.now()}`, icon: points > 0 ? 'fa-solid fa-recycle' : 'fa-solid fa-bag-shopping', description: description || (points > 0 ? 'Puntos ganados' : 'Puntos canjeados'), timestamp: 'Ahora', points: points }; if (points > 0) showToast(`+${points} puntos: ${description}`, 'success'); return { ...prev, stats: { ...prev.stats, points: prev.stats.points + points }, history: [newHistoryItem, ...prev.history].slice(0, 50) }; }); }, [setAppState, showToast]); const consumeEnergy = useCallback((callback) => { setAppState(prev => { if (prev.energy > 0) { callback(true); const newLastRecharge = prev.energy === 5 ? Date.now() : prev.lastEnergyRecharge; return { ...prev, energy: prev.energy - 1, lastEnergyRecharge: newLastRecharge }; } callback(false); return prev; }); }, [setAppState]); const completeLearningStep = useCallback((pathId, stepId) => { setAppState(prev => { const newPaths = prev.learningPaths.map(path => { if (path.id === pathId) { let stepCompleted = false; const newSteps = path.steps.map((step, index) => { if (step.id === stepId && step.status !== 'completed') { stepCompleted = true; updatePoints(step.points, `Paso completado: ${step.title}`); return { ...step, status: 'completed' }; } return step; }); if (!stepCompleted) return path; const completedStepIndex = newSteps.findIndex(s => s.id === stepId); if (completedStepIndex !== -1 && completedStepIndex + 1 < newSteps.length) newSteps[completedStepIndex + 1].status = 'available'; const isPathComplete = newSteps.every(s => s.status === 'completed'); if (isPathComplete && !path.isCompleted) { showToast(`¡Ruta de aprendizaje "${path.title}" completada!`, 'success'); updatePoints(path.rewardPoints, `Recompensa de ruta: ${path.title}`); return { ...path, steps: newSteps, isCompleted: true }; } return { ...path, steps: newSteps }; } return path; }); return { ...prev, learningPaths: newPaths }; }); }, [setAppState, updatePoints, showToast]); const handlePurchasePro = () => { setProUser(true); setShowProModal(false); showToast("¡Felicidades! Ahora eres un EcoPunto Pro.", 'success'); updatePoints(500, 'Bono por suscripción Pro'); }; const contextValue = { user, onUserUpdate: setUser, isProUser, onProClick: handleProClick, appState, setAppState, updatePoints, showToast, consumeEnergy, activeGame, setActiveGame, completeLearningStep }; if (!isLoggedIn) return React.createElement(LoginPage, { onLogin: handleLogin }); return React.createElement(AppContext.Provider, { value: contextValue }, React.createElement(AppLayout, { onLogout: handleLogout }), showProModal && React.createElement(ProModal, { onClose: () => setShowProModal(false), onConfirm: handlePurchasePro })); };
const App = () => React.createElement('div', { className: 'font-sans' }, React.createElement(ToastProvider, null, React.createElement(AppContent, null)));

// --- START: index.tsx (Entry Point) ---
const rootElement = document.getElementById('root');
if (!rootElement) throw new Error("Could not find root element to mount to");
const root = ReactDOM.createRoot(rootElement);
root.render( React.createElement(React.StrictMode, null, React.createElement(App, null)) );
</script>
  </body>
</html>
